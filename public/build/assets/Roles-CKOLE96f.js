var A=Object.defineProperty;var D=(o,s,r)=>s in o?A(o,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[s]=r;var u=(o,s,r)=>D(o,typeof s!="symbol"?s+"":s,r);import{j as t}from"./Accordion-B0xeqd_u.js";import{r as l}from"./index-B80Lgev0.js";import{c as O}from"./ReactAppend-Da6mr3zD.js";import{C as P}from"./CreateReactScript-RU15QjVK.js";import{T as G,R as f}from"./Table-BkcvNzc5.js";import{T as M,P as w}from"./TextareaFormGroup-CTgsu98K.js";import{m as n}from"./main-DtAlmsP1.js";import{A as B}from"./Adminto-CShpcwxy.js";import{M as N}from"./Modal-DydUDwtE.js";import{C as L}from"./CheckboxFormGroup-B6kqgdBb.js";import{I as _}from"./InputFormGroup-Bup-dfDc.js";import{T as y}from"./TippyButton-Bqhz5Wik.js";import"./index-STwnHZb6.js";import"./index.esm-B9FXdcpn.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./Logout-C-aUOij0.js";import"./tippy-react.esm-PO7soYrD.js";import"./TippyButton-DN-nzi_f.js";import"./WhatsAppModal-BYoU6ug0.js";import"./SurveyStep-C1GxQ1hd.js";class m{}u(m,"paginate",async s=>{const{result:r}=await n.Fetch("/api/roles/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)});return r}),u(m,"byUser",async s=>{const{result:r}=await n.Fetch(`/api/roles/user/${s}`);return r.data??[]}),u(m,"save",async s=>{try{const{status:r,result:a}=await n.Fetch("/api/roles",{method:"POST",body:JSON.stringify(s)});if(!r)throw new Error((a==null?void 0:a.message)||"Ocurrio un error inesperado");return n.Notify.add({icon:"/assets/img/icon.svg",title:"Correcto",body:a.message,type:"success"}),!0}catch(r){return n.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:r.message,type:"danger"}),!1}}),u(m,"status",async({id:s,status:r})=>{try{const{status:a,result:c}=await n.Fetch("/api/roles/status",{method:"PATCH",body:JSON.stringify({id:s,status:r})});if(!a)throw new Error((c==null?void 0:c.message)??"Ocurrio un error inesperado");return n.Notify.add({icon:"/assets/img/icon.svg",title:"Correcto",body:c.message,type:"success"}),!0}catch(a){return n.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:a.message,type:"danger"}),!1}}),u(m,"delete",async s=>{try{const{status:r,result:a}=await n.Fetch(`/api/roles/${s}`,{method:"DELETE"});if(!r)throw new Error((a==null?void 0:a.message)??"Ocurrio un error inesperado");return n.Notify.add({icon:"/assets/img/icon.svg",title:"Correcto",body:a.message,type:"success"}),!0}catch(r){return n.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:r.message,type:"danger"}),!1}});const I=({id:o,children:s,className:r})=>t.jsx("div",{id:o,className:`accordion custom-accordion ${r}`,children:s}),q=({title:o,id:s,parent:r,children:a,className:c,isOpened:p})=>t.jsxs("div",{className:"card mb-1",children:[t.jsx("div",{className:"card-header p-0",id:`heading-${s}`,children:t.jsx("h5",{className:"m-0",children:t.jsx("a",{className:`d-block text-dark ${!p&&"collapsed"} p-2`,"data-bs-toggle":"collapse",href:`#${s}`,"aria-expanded":"false",children:o})})}),t.jsx("div",{id:s,className:`collapse ${p&&"show"}`,"aria-labelledby":`heading-${s}`,"data-bs-parent":`#${r}`,children:t.jsx("div",{className:`card-body p-2 ${c}`,children:a})})]}),J=({permissions:o})=>{o=Object.values(o.map(e=>{const[i]=e.name.split(".");return{...e,origin:i}}).reduce((e,i)=>(e[i.origin]||(e[i.origin]=[]),e[i.origin].push(i),e),{}));const s=l.useRef(),r=l.useRef(),a=l.useRef();l.useRef();const c=l.useRef(),p=l.useRef(),x=l.useRef(),[R,b]=l.useState(!1),[j,E]=l.useState({}),v=e=>{e!=null&&e.id?b(!0):b(!1),c.current.value=(e==null?void 0:e.id)||null,p.current.value=(e==null?void 0:e.name)||null,x.current.value=(e==null?void 0:e.description)||null,$(r.current).modal("show")},T=async e=>{E(e);const i=await w.byRole(e.id);$("#permissions input").prop("checked",!1),i.forEach(({name:d})=>{$(`[name="${d}"]`).prop("checked",!0)}),$(a.current).modal("show")},F=async e=>{e.preventDefault();const i={id:c.current.value||void 0,name:p.current.value,description:x.current.value};await m.save(i)&&($(s.current).dxDataGrid("instance").refresh(),$(r.current).modal("hide"))},C=async e=>{e.preventDefault();const i=[...$("#permissions input:checked")].map(g=>g.value),d={role_id:j.id,permissions:i};await w.massiveByRole(d)&&($(a.current).modal("hide"),$(s.current).dxDataGrid("instance").refresh())},S=async e=>{await m.delete(e)&&$(s.current).dxDataGrid("instance").refresh()};return t.jsxs(t.Fragment,{children:[t.jsx(G,{gridRef:s,title:"Roles",rest:m,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(s.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"Nuevo registro",onClick:()=>v()}})},columns:[{dataField:"id",caption:"ID",dataType:"number",sortOrder:"asc"},{dataField:"name",caption:"Rol"},{dataField:"description",caption:"Descripcion"},{dataField:"created_at",caption:"Fecha creacion",dataType:"date",cellTemplate:(e,{data:i})=>{f(e,t.jsx("span",{children:moment(i.created_at).format("LL")}))}},{dataField:"updated_at",caption:"Fecha actualizacion",dataType:"date",cellTemplate:(e,{data:i})=>{f(e,t.jsx("span",{children:moment(i.updated_at).format("LL")}))}},{caption:"Acciones",cellTemplate:(e,{data:i})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),f(e,t.jsx(y,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>v(i),children:t.jsx("i",{className:"fa fa-pen"})})),f(e,t.jsx(y,{className:"btn btn-xs btn-soft-dark",title:"Modificar permisos",onClick:()=>T(i),"data-loading-text":'<i class="fa fa-spinner fa-spin"></i>',children:t.jsx("i",{className:"fas fa-th-list"})})),f(e,t.jsx(y,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>S(i.id),children:t.jsx("i",{className:"fa fa-trash-alt"})}))},allowFiltering:!1,allowExporting:!1}]}),t.jsx(N,{modalRef:r,title:R?"Editar rol":"Agregar rol",onSubmit:F,children:t.jsxs("div",{className:"row",children:[t.jsx("input",{ref:c,type:"hidden"}),t.jsx(_,{eRef:p,label:"Rol",col:"col-12",required:!0}),t.jsx(M,{eRef:x,label:"Descripcion",col:"col-12"})]})}),t.jsx(N,{modalRef:a,title:`Permisos para ${j.name}`,btnSubmitText:"Guardar",onSubmit:C,size:"sm",children:t.jsx(I,{id:"permissions",children:o.map((e,i)=>{const d=e[0].origin;return t.jsx(q,{id:`permission-${d}`,title:d,parent:"permissions",className:"d-flex gap-2 flex-wrap flex-row",children:e.map(({id:h,name:g,description:k})=>t.jsx(L,{className:"mb-0",id:`permission-ck-${h}`,label:g.replace(`${d}.`,""),name:g,value:h,title:k,style:{width:"max-content"},rounded:!0},`permission-${h}`))},`accordion-${i}`)})})})]})};P((o,s)=>{O(o).render(t.jsx(B,{...s,title:"Roles",children:t.jsx(J,{...s})}))});

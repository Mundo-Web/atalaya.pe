var E=Object.defineProperty;var R=(r,a,l)=>a in r?E(r,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[a]=l;var w=(r,a,l)=>R(r,typeof a!="symbol"?a+"":a,l);import{j as e}from"./Accordion-B0xeqd_u.js";import{c as k}from"./ReactAppend-Da6mr3zD.js";import{G as v,C as P}from"./CreateReactScript-D3qb0hcY.js";import{A as _}from"./Adminto-CM-4Vh3D.js";import{r as x}from"./index-B80Lgev0.js";import{S as b}from"./SurveyStep-C1GxQ1hd.js";import{B as A}from"./BusinessesRest-CvkkDKnD.js";import{i as C}from"./tippy-react.esm-PO7soYrD.js";import{U as F}from"./UsersByServicesByBusinessesRest-BuMJH5bE.js";import"./RootBusinessCard-BoxzY95L.js";import{S as D}from"./ServicesByBusinessesRest-C4vVMHm8.js";import{M}from"./Modal-C44m6j55.js";import{B as y}from"./BusinessIWorkCard-BsMRBA8t.js";import"./main-DtAlmsP1.js";import"./index-STwnHZb6.js";import"./index.esm-X2U-7gJn.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./Logout-C-aUOij0.js";import"./TippyButton-DN-nzi_f.js";import"./WhatsAppModal-BYoU6ug0.js";import"./index-BK7CmI7H.js";const T=new F,I=new D,U=({onPaymentClicked:r,onStatusClicked:a,onDeleteClicked:l,...i})=>{var u,j;const[n,f]=x.useState(i.users),[d,g]=x.useState(i.services),N=async t=>{const{isConfirmed:o}=await b.fire({title:"¿Estás seguro?",text:"No podrás revertir esta acción",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!o||!await T.delete(t)||f(c=>c.filter(m=>m.match_id!==t))},p=async t=>{const{isConfirmed:o}=await b.fire({title:"¿Estás seguro?",text:"No podrás revertir esta acción",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!o||!await I.delete(t)||g(c=>c.filter(m=>m.match_id!==t))};return e.jsx("div",{className:"card mb-0",style:{width:"420px"},children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"dropdown float-end",children:[e.jsx("a",{href:"#",className:"dropdown-toggle arrow-none card-drop","data-bs-toggle":"dropdown","aria-expanded":"false",children:e.jsx("i",{className:"mdi mdi-dots-vertical"})}),e.jsxs("div",{className:"dropdown-menu dropdown-menu-end ",children:[i.status?e.jsxs("button",{className:"dropdown-item",onClick:()=>a(i.id,!0),children:[e.jsx("i",{className:"mdi mdi-cancel me-1"}),e.jsx("span",{children:"Deshabilitar"})]}):e.jsxs("button",{className:"dropdown-item",onClick:()=>a(i.id,!1),children:[e.jsx("i",{className:"mdi mdi-restore me-1"}),e.jsx("span",{children:"Habilitar"})]}),e.jsx(C,{content:"Eliminar definitivamente",children:e.jsxs("button",{className:"dropdown-item",onClick:()=>l(i.id),children:[e.jsx("i",{className:"mdi mdi-delete me-1"}),e.jsx("span",{children:"Eliminar"})]})})]})]}),e.jsxs("h4",{className:"header-title mt-0 mb-1 text-truncate",children:[!i.status&&e.jsx("small",{className:"me-1 text-danger fw-bold",children:"(Deshabilitada)"}),i.name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"d-block",children:(u=i.creator)==null?void 0:u.fullname}),e.jsx("small",{className:"text-muted",children:(j=i.creator)==null?void 0:j.email})]}),(d==null?void 0:d.length)>0&&e.jsx("div",{className:"d-flex gap-2",children:d==null?void 0:d.map(t=>e.jsxs("div",{className:"dropdown",children:[e.jsx("img",{className:"avatar-xs dropdown-toggle","data-bs-toggle":"dropdown",style:{objectFit:"contain",objectPosition:"center",cursor:"pointer"},src:`//${t.correlative}.${v.APP_DOMAIN}/assets/img/icon.svg`,onError:o=>o.target.src="/assets/img/icon.svg",alt:t.name}),e.jsxs("div",{className:"dropdown-menu",children:[e.jsxs("a",{className:"dropdown-item",href:`//${t.correlative}.${v.APP_DOMAIN}`,target:"_blank",children:[e.jsx("i",{className:"mdi mdi-open-in-new me-1"}),e.jsxs("span",{children:["Abrir ",t.name]})]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>r(t.match_id),children:[e.jsx("i",{className:"mdi mdi-cash-multiple me-1"}),e.jsx("span",{children:"Ver pagos"}),t.exempt?e.jsx("small",{className:"text-muted ms-1",children:"Exonerado"}):null]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>p(t.match_id),children:[e.jsx("i",{className:"mdi mdi-delete me-1"}),e.jsx("span",{children:"Eliminar vinculo"})]})]})]},t.id))}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("hr",{className:"flex-grow-1 my-2"}),e.jsxs("span",{children:[(n==null?void 0:n.length)||0," usuarios"]})]}),e.jsx("div",{className:"table-responsive",style:{height:"241px"},children:e.jsx("table",{className:"table table-sm mb-0",children:e.jsx("tbody",{children:n==null?void 0:n.map((t,o)=>e.jsxs("tr",{children:[e.jsx("td",{valign:"middle",style:{width:"0%",borderBottomWidth:o===n.length-1?0:void 0},children:e.jsxs("div",{className:"position-relative",style:{width:"max-content",height:"max-content"},children:[e.jsx("img",{src:`/api/profile/thumbnail/${t.relative_id}`,alt:"",className:"avatar-sm rounded-circle"}),e.jsx(C,{content:t.service.name,children:e.jsx("img",{className:"position-absolute bg-white rounded border",src:`//${t.service.correlative}.${v.APP_DOMAIN}/assets/img/icon.svg`,onError:s=>s.target.src="/assets/img/icon.svg",alt:t.service.name,style:{objectFit:"contain",objectPosition:"center",width:"20px",height:"20px",padding:"2px",bottom:"-6px",right:"-6px"}})})]})}),e.jsxs("td",{style:{width:"100%",borderBottomWidth:o===n.length-1?0:void 0},children:[e.jsx("span",{className:"d-block",children:t.fullname}),e.jsx("small",{className:"text-muted",children:t.email})]}),e.jsx("td",{valign:"middle",style:{borderBottomWidth:o===n.length-1?0:void 0},children:t.id!=i.creator.id&&e.jsx("button",{className:"btn btn-xs btn-soft-danger",onClick:()=>N(t.match_id),children:e.jsx("i",{className:"fa fa-trash-alt"})})})]},o))})})})]})},i.id)};class O extends y{constructor(){super(...arguments);w(this,"path","root/plan-payments")}}class W extends y{constructor(){super(...arguments);w(this,"path","root/services-by-business")}}const B=new A,G=new O,H=new W,L=({businesses:r})=>{var t,o;const a=x.useRef(),[l,i]=x.useState(r),[n,f]=x.useState(null),[d,g]=x.useState([]),N=async s=>{const{status:c,data:m,summary:h}=await G.paginate({match_id:s,filter:["service_by_business_id","=",s]});c==200&&(f(h),g(m),$(a.current).modal("show"))},p=async s=>{await H.save({id:n.match_id,exempt:s})&&location.reload()},u=async(s,c)=>{const m=await B.status({id:s,status:c});i(l.map(h=>h.id===s?m:h))},j=async s=>{!(await b.fire({title:"¿Estás seguro?",text:"¡Esta acción no se puede deshacer!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Sí, continuar!"})).isConfirmed||!(await b.fire({title:"¿Estás REALMENTE seguro?",text:"¡Esta es tu última oportunidad, la acción no se podrá revertir!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Sí, eliminar definitivamente!"})).isConfirmed||!await B.delete(s)||i(l.filter(S=>S.id!==s))};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-flex flex-wrap gap-3 justify-content-center",children:l.map(s=>e.jsx(U,{...s,onPaymentClicked:N,onStatusClicked:u,onDeleteClicked:j}))}),e.jsxs(M,{modalRef:a,title:"Historial de pagos",hideFooter:!0,children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Empresa:"})," ",((t=n==null?void 0:n.business)==null?void 0:t.name)??""]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Servicio:"})," ",((o=n==null?void 0:n.service)==null?void 0:o.name)??""]})]}),n!=null&&n.exempt?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-sm btn-dark",type:"button",onClick:()=>p(!1),children:"Dejar de exonerar"}),e.jsx("div",{className:"alert alert-info mt-2 mb-0",children:"Este cliente está exonerado de pagos"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-sm btn-success",type:"button",onClick:()=>p(!0),children:"Exonerar pagos"}),e.jsx("div",{className:"table-responsive mt-2",children:e.jsxs("table",{className:"table table-sm table-centered table-bordered mb-0 text-center",children:[e.jsxs("thead",{children:[e.jsxs("tr",{children:[e.jsx("th",{rowSpan:2,children:"Fecha de pago"}),e.jsx("th",{colSpan:2,children:"Cobertura"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Fecha Inicio"}),e.jsx("th",{children:"Fecha Fin"})]})]}),e.jsxs("tbody",{children:[d.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.created_at}),e.jsx("td",{children:s.begins_at}),e.jsx("td",{children:s.ends_at})]},s.id)),e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center",children:e.jsxs("div",{className:"btn-group",children:[e.jsxs("button",{className:"btn btn-sm btn-primary",type:"button",children:[e.jsx("i",{className:"mdi mdi-plus me-1"}),"Pago Mensual"]}),e.jsxs("button",{className:"btn btn-sm btn-success",type:"button",children:[e.jsx("i",{className:"mdi mdi-plus me-1"}),"Pago Anual"]})]})})})]})]})})]})]})]})};P((r,a)=>{if(!a.can("businesses","root"))return location.href="/";k(r).render(e.jsx(_,{...a,title:"Empresas",children:e.jsx(L,{...a})}))});

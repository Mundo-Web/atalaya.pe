var x=Object.defineProperty;var h=(r,t,o)=>t in r?x(r,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[t]=o;var d=(r,t,o)=>h(r,typeof t!="symbol"?t+"":t,o);import{j as e}from"./Accordion-B0xeqd_u.js";import{c as j}from"./ReactAppend-Da6mr3zD.js";import{C as b,G as g}from"./CreateReactScript-wxngZ06p.js";import{A as R}from"./Adminto-qSKIGh_4.js";import{T as B,R as u}from"./Table-BKtRPVyk.js";import{r as m}from"./index-B80Lgev0.js";import{D as w}from"./DxButton-CsjWvhyj.js";import{S as p}from"./SurveyStep-C1GxQ1hd.js";import{B as C}from"./BusinessIWorkCard-CmzstVqU.js";import{M as E}from"./Modal-DydUDwtE.js";import{B as F}from"./BusinessesRest-CnXtJ3iL.js";import"./index-STwnHZb6.js";import"./index.esm-X2U-7gJn.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./main-DtAlmsP1.js";import"./Logout-C-aUOij0.js";import"./tippy-react.esm-PO7soYrD.js";import"./TippyButton-DN-nzi_f.js";import"./WhatsAppModal-BYoU6ug0.js";import"./index-BK7CmI7H.js";class S extends C{constructor(){super(...arguments);d(this,"path","root/users")}}const N=new F,_=({data:r,modalRef:t,setBusinesses:o})=>{const[c,l]=m.useState(!1),s=async()=>{l(!0);const n=await N.byUser(r.id);l(!1),n&&(o(n),$(t.current).modal("show"))};return e.jsx("button",{className:"btn btn-xs btn-soft-primary",onClick:s,disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-loading mdi-spin me-1"}),e.jsx("span",{children:"Cargando"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"me-1",children:r.businesses_count}),r.businesses_count>1?"Empresas":"Empresa"]})})},f=new S,y=()=>{const r=m.useRef(),t=m.useRef(),[o,c]=m.useState([]),l=async s=>{!(await p.fire({title:"¿Estás seguro?",text:"¡Esta acción no se puede deshacer!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Sí, eliminar!"})).isConfirmed||s.businesses_count>0&&!(await p.fire({title:"¡Atención!",text:"Este usuario tiene empresas asociadas. Al eliminarlo, también se eliminarán todas sus empresas. ¿Estás realmente seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Sí, eliminar todo!"})).isConfirmed||!await f.delete(s.id)||$(r.current).dxDataGrid("instance").refresh()};return e.jsxs(e.Fragment,{children:[e.jsx(B,{gridRef:r,title:"Usuarios",toolBar:s=>{s.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(r.current).dxDataGrid("instance").refresh()}})},rest:f,pageSize:25,columns:[{dataField:"person.document_number",caption:"Documento",width:"120px",cellTemplate:(s,{data:n})=>{var i,a;u(s,e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"badge bg-primary me-1",children:((i=n.person)==null?void 0:i.document_type)??"SD"}),((a=n.person)==null?void 0:a.document_number)??"00000000"]}))}},{dataField:"fullname",caption:"Usuario"},{dataField:"email",caption:"Correo electrónico"},{dataField:"businesses_count",caption:"Empresas",allowFiltering:!1,cellTemplate:(s,{data:n})=>{n.businesses_count!=0&&u(s,e.jsx(_,{data:n,modalRef:t,setBusinesses:c}))}},{caption:"Roles",cellTemplate:(s,{data:n})=>{var i;s.text((i=n.roles)==null?void 0:i.map(a=>a.name).sort().join(", "))}},{caption:"Acciones",cellTemplate:(s,{data:n})=>{s.append(w({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash-alt",onClick:()=>l(n)}))}}]}),e.jsx(E,{modalRef:t,title:"Empresas",children:e.jsxs("table",{className:"table table-sm mb-0 table-bordered",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Empresa"}),e.jsx("th",{children:"Servicios"}),e.jsx("th",{children:"Usuarios"})]}),e.jsx("tbody",{children:o.map(s=>{var n;return e.jsxs("tr",{children:[e.jsx("td",{children:s.name}),e.jsx("td",{children:e.jsx("div",{className:"d-flex flex-wrap gap-1",children:(n=s.services)==null?void 0:n.map(i=>e.jsx("img",{className:"avatar-xs",src:`//${i.correlative}.${g.APP_DOMAIN}/assets/img/icon.svg`,onError:a=>a.target.src="/assets/img/icon.svg",alt:i.name,style:{objectFit:"contain",objectPosition:"center"}}))})}),e.jsx("td",{children:s.users.length})]},s.id)})})]})})]})};b((r,t)=>{if(!t.can("users","root"))return location.href="/";j(r).render(e.jsx(R,{...t,title:"Usuarios",children:e.jsx(y,{...t})}))});

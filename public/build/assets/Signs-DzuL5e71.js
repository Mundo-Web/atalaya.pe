var C=Object.defineProperty;var k=(a,r,l)=>r in a?C(a,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[r]=l;var R=(a,r,l)=>k(a,typeof r!="symbol"?r+"":r,l);import{r as n,j as e,C as I,c as _}from"./CreateReactScript-BRu_lQJW.js";import{A as $,i as D}from"./Adminto-P-friiKm.js";import{S}from"./sweetalert2.esm.all-B0Dix5B2.js";import{B as U}from"./BasicRest-D1X3jnBu.js";import{M as L}from"./Modal-M7u4bmpP.js";import{I as M}from"./InputFormGroup-DDAWgn3z.js";class T extends U{constructor(){super(...arguments);R(this,"path","signs");R(this,"hasFiles",!0)}}const q=({id:a,col:r,label:l,eRef:u,required:b=!1,onChange:p=()=>{},aspect:m="21/9",fit:j="cover",width:y="100%",height:N,containerStyle:E,onError:h="/api/cover/thumbnail/null"})=>{a||(a=`ck-${crypto.randomUUID()}`),u||(u=n.useRef());const g=n.useRef(),w=async c=>{const x=c.target.files[0],v=await File.toURL(x);g.current.src=v,p(c)};return n.useEffect(()=>{u.image=g.current},[null]),e.jsxs("div",{className:`form-group ${r} mb-1`,style:E,children:[e.jsxs("label",{htmlFor:a,className:"d-block form-label",children:[l," ",b&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("label",{className:"d-block",htmlFor:a,style:{width:"max-content"},children:e.jsx("img",{ref:g,className:"d-block",src:"",alt:"aspect-video",onError:c=>{c.onError=null,c.target.src=h},style:{width:y,height:N,borderRadius:"4px",cursor:"pointer",aspectRatio:m,objectFit:j,objectPosition:"center"}})}),e.jsx("input",{ref:u,id:a,type:"file",src:"",alt:"",hidden:!0,accept:"image/*",onChange:w})]})},F=new T,G=({businesses:a=[]})=>{const r=n.useRef(),l=n.useRef(),u=n.useRef(),b=n.useRef(),[p,m]=n.useState(!1),[j,y]=n.useState([]),[N,E]=n.useState(!1),h=j.reduce((t,s)=>(t[s.business_id]||(t[s.business_id]=[]),t[s.business_id].push(s),t),{}),g=async t=>{t.preventDefault()},w=async t=>{const s=t.target.files[0];if(!s)return;if(t.target.value=null,!s.type.startsWith("image/")){S.fire({title:"Error",text:"El archivo debe ser una imagen",icon:"error",confirmButtonText:"Aceptar"});return}const{value:i}=await S.fire({title:"Nombre de la firma",input:"text",inputLabel:"Ingrese un nombre para identificar esta firma",showCancelButton:!0,inputValidator:B=>{if(!B)return"Debe ingresar un nombre"}});if(!i)return;const d=t.target.getAttribute("data-id"),f=t.target.getAttribute("data-sign"),o=new FormData;f&&o.append("id",f),o.append("sign",s),o.append("business_id",d),o.append("name",i),m(!0);const A=await F.save(o);m(!1),A&&x()},c=async t=>{const{isConfirmed:s}=await S.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"No, cancelar"});if(!s)return;m(!0);const i=await F.delete(t);m(!1),i&&x()},x=async()=>{const t=await F.paginate({isLoadingAll:!0,sort:[{selector:"created_at",desc:!1}]});t&&y(t.data)};n.useEffect(()=>{x()},[null]);const v=(t,s,i)=>{var f;const d=`file-${t.uuid}-${i}`;return e.jsxs("div",{className:"position-relative",style:{width:"25%",aspectRatio:".5"},children:[s?e.jsxs(e.Fragment,{children:[e.jsxs("label",{htmlFor:d,className:"w-100 h-100",children:[e.jsx("img",{src:`/repository/signs/${s.sign}`,alt:`${t.name} signature ${i+1}`,className:"w-100 h-100",style:{objectFit:"cover",objectPosition:"center",cursor:p?"not-allowed":"pointer"}}),e.jsx("div",{className:"position-absolute bottom-0 start-0 end-0 bg-dark bg-opacity-75 text-white p-1",children:e.jsx("small",{className:"d-block text-center text-truncate",children:s.name||"Sin nombre"})})]}),e.jsx(D,{content:"Quitar firma",children:e.jsx("i",{className:"mdi mdi-trash-can mdi-24px position-absolute text-danger",style:{top:"0.25rem",right:"0.25rem"},type:"button",onClick:()=>c(s.id)})})]}):e.jsx("label",{htmlFor:d,className:"d-flex align-items-center justify-content-center w-100 h-100",style:{cursor:p?"not-allowed":"pointer"},children:e.jsx("div",{className:"text-center text-muted",children:e.jsx("i",{className:"fa fa-plus fa-lg"})})}),e.jsx("input",{id:d,type:"file",className:"form-control",accept:"image/*",hidden:!0,"data-id":t.uuid,"data-sign":s==null?void 0:s.id,onChange:w,disabled:p||((f=h[t.id])==null?void 0:f.length)>=4&&!s})]})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"calc(100vh - 135px)"},children:e.jsx("div",{className:"d-flex flex-wrap justify-content-center gap-3",style:{maxWidth:"960px"},children:a.map((t,s)=>{const i=h[t.id]||[],d=new Array(i.length<4?i.length+1:4).fill(null);return e.jsxs("div",{className:"card mb-0",style:{width:"280px"},children:[e.jsx("div",{className:"card-body position-relative p-0",children:e.jsx("div",{className:"d-flex",children:d.map((f,o)=>v(t,i[o],o))})}),e.jsx("div",{className:"card-footer bg-light",children:e.jsxs("h6",{className:"text-center my-0 text-truncate",children:[e.jsx("i",{className:"fa fa-building me-1"}),e.jsx("b",{children:t.name})]})})]},`business-${s}`)})})}),e.jsx(L,{modalRef:r,title:N?"Editar firmga":"Agregar firmga",onSubmit:g,size:"md",children:e.jsxs("div",{className:"row",id:"settings-crud-container",children:[e.jsx("input",{ref:l,type:"hidden"}),e.jsx(M,{eRef:u,label:"Alias",col:"col-12",required:!0}),e.jsx(q,{eRef:b,label:"Firma",col:"col-12",required:!0})]})})]})};I((a,r)=>{_(a).render(e.jsx($,{...r,title:"Firmas digitales",children:e.jsx(G,{...r})}))});

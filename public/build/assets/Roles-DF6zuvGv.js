var A=Object.defineProperty;var D=(o,s,r)=>s in o?A(o,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[s]=r;var p=(o,s,r)=>D(o,typeof s!="symbol"?s+"":s,r);import{m as n,j as t,C as O,c as P,r as l}from"./CreateReactScript-nMznkPmF.js";import{T as G,R as f}from"./Table-ShMdi2FX.js";import{T as M,P as w}from"./TextareaFormGroup-CZatD6B8.js";import{A as B}from"./Adminto-Bn6MmTFy.js";import{M as N}from"./Modal-BK21EWzi.js";import{C as L}from"./CheckboxFormGroup-CKOqwbh8.js";import{I as _}from"./InputFormGroup-CQuSc5Wj.js";import{T as y}from"./TippyButton-DqW3w14U.js";import"./Logout-B6F4csKf.js";import"./sweetalert2.esm.all-B0Dix5B2.js";class u{}p(u,"paginate",async s=>{const{result:r}=await n.Fetch("/api/roles/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)});return r}),p(u,"byUser",async s=>{const{result:r}=await n.Fetch(`/api/roles/user/${s}`);return r.data??[]}),p(u,"save",async s=>{try{const{status:r,result:i}=await n.Fetch("/api/roles",{method:"POST",body:JSON.stringify(s)});if(!r)throw new Error((i==null?void 0:i.message)||"Ocurrio un error inesperado");return n.Notify.add({icon:"/assets/img/icon.svg",title:"Correcto",body:i.message,type:"success"}),!0}catch(r){return n.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:r.message,type:"danger"}),!1}}),p(u,"status",async({id:s,status:r})=>{try{const{status:i,result:c}=await n.Fetch("/api/roles/status",{method:"PATCH",body:JSON.stringify({id:s,status:r})});if(!i)throw new Error((c==null?void 0:c.message)??"Ocurrio un error inesperado");return n.Notify.add({icon:"/assets/img/icon.svg",title:"Correcto",body:c.message,type:"success"}),!0}catch(i){return n.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message,type:"danger"}),!1}}),p(u,"delete",async s=>{try{const{status:r,result:i}=await n.Fetch(`/api/roles/${s}`,{method:"DELETE"});if(!r)throw new Error((i==null?void 0:i.message)??"Ocurrio un error inesperado");return n.Notify.add({icon:"/assets/img/icon.svg",title:"Correcto",body:i.message,type:"success"}),!0}catch(r){return n.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:r.message,type:"danger"}),!1}});const I=({id:o,children:s,className:r})=>t.jsx("div",{id:o,className:`accordion custom-accordion ${r}`,children:s}),q=({title:o,id:s,parent:r,children:i,className:c,isOpened:m})=>t.jsxs("div",{className:"card mb-1",children:[t.jsx("div",{className:"card-header p-0",id:`heading-${s}`,children:t.jsx("h5",{className:"m-0",children:t.jsx("a",{className:`d-block text-dark ${!m&&"collapsed"} p-2`,"data-bs-toggle":"collapse",href:`#${s}`,"aria-expanded":"false",children:o})})}),t.jsx("div",{id:s,className:`collapse ${m&&"show"}`,"aria-labelledby":`heading-${s}`,"data-bs-parent":`#${r}`,children:t.jsx("div",{className:`card-body p-2 ${c}`,children:i})})]}),J=({permissions:o})=>{o=Object.values(o.map(e=>{const[a]=e.name.split(".");return{...e,origin:a}}).reduce((e,a)=>(e[a.origin]||(e[a.origin]=[]),e[a.origin].push(a),e),{}));const s=l.useRef(),r=l.useRef(),i=l.useRef();l.useRef();const c=l.useRef(),m=l.useRef(),x=l.useRef(),[R,b]=l.useState(!1),[j,E]=l.useState({}),v=e=>{e!=null&&e.id?b(!0):b(!1),c.current.value=(e==null?void 0:e.id)||null,m.current.value=(e==null?void 0:e.name)||null,x.current.value=(e==null?void 0:e.description)||null,$(r.current).modal("show")},T=async e=>{E(e);const a=await w.byRole(e.id);$("#permissions input").prop("checked",!1),a.forEach(({name:d})=>{$(`[name="${d}"]`).prop("checked",!0)}),$(i.current).modal("show")},F=async e=>{e.preventDefault();const a={id:c.current.value||void 0,name:m.current.value,description:x.current.value};await u.save(a)&&($(s.current).dxDataGrid("instance").refresh(),$(r.current).modal("hide"))},C=async e=>{e.preventDefault();const a=[...$("#permissions input:checked")].map(g=>g.value),d={role_id:j.id,permissions:a};await w.massiveByRole(d)&&($(i.current).modal("hide"),$(s.current).dxDataGrid("instance").refresh())},S=async e=>{await u.delete(e)&&$(s.current).dxDataGrid("instance").refresh()};return t.jsxs(t.Fragment,{children:[t.jsx(G,{gridRef:s,title:"Roles",rest:u,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(s.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"Nuevo registro",onClick:()=>v()}})},columns:[{dataField:"id",caption:"ID",dataType:"number",sortOrder:"asc"},{dataField:"name",caption:"Rol"},{dataField:"description",caption:"Descripcion"},{dataField:"created_at",caption:"Fecha creacion",dataType:"date",cellTemplate:(e,{data:a})=>{f(e,t.jsx("span",{children:moment(a.created_at).format("LL")}))}},{dataField:"updated_at",caption:"Fecha actualizacion",dataType:"date",cellTemplate:(e,{data:a})=>{f(e,t.jsx("span",{children:moment(a.updated_at).format("LL")}))}},{caption:"Acciones",cellTemplate:(e,{data:a})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),f(e,t.jsx(y,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>v(a),children:t.jsx("i",{className:"fa fa-pen"})})),f(e,t.jsx(y,{className:"btn btn-xs btn-soft-dark",title:"Modificar permisos",onClick:()=>T(a),"data-loading-text":'<i class="fa fa-spinner fa-spin"></i>',children:t.jsx("i",{className:"fas fa-th-list"})})),f(e,t.jsx(y,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>S(a.id),children:t.jsx("i",{className:"fa fa-trash-alt"})}))},allowFiltering:!1,allowExporting:!1}]}),t.jsx(N,{modalRef:r,title:R?"Editar rol":"Agregar rol",onSubmit:F,children:t.jsxs("div",{className:"row",children:[t.jsx("input",{ref:c,type:"hidden"}),t.jsx(_,{eRef:m,label:"Rol",col:"col-12",required:!0}),t.jsx(M,{eRef:x,label:"Descripcion",col:"col-12"})]})}),t.jsx(N,{modalRef:i,title:`Permisos para ${j.name}`,btnSubmitText:"Guardar",onSubmit:C,size:"sm",children:t.jsx(I,{id:"permissions",children:o.map((e,a)=>{const d=e[0].origin;return t.jsx(q,{id:`permission-${d}`,title:d,parent:"permissions",className:"d-flex gap-2 flex-wrap flex-row",children:e.map(({id:h,name:g,description:k})=>t.jsx(L,{className:"mb-0",id:`permission-ck-${h}`,label:g.replace(`${d}.`,""),name:g,value:h,title:k,style:{width:"max-content"},rounded:!0},`permission-${h}`))},`accordion-${a}`)})})})]})};O((o,s)=>{P(o).render(t.jsx(B,{...s,title:"Roles",children:t.jsx(J,{...s})}))});

var D=Object.defineProperty;var O=(o,t,a)=>t in o?D(o,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[t]=a;var p=(o,t,a)=>O(o,typeof t!="symbol"?t+"":t,a);import{m as i,R as r,C as P,c as G,r as l}from"./CreateReactScript-BEd-rCvk.js";import{T as M,R as f}from"./Table-CkOiOv3b.js";import{T as B,P as N}from"./TextareaFormGroup-CUvY7Js5.js";import{A as L}from"./Adminto-DLuiK9jn.js";import{M as R}from"./Modal-BOzbh0wA.js";import{C as _}from"./CheckboxFormGroup-BhA5f6a8.js";import{I}from"./InputFormGroup-BeEaa9zP.js";import{T as E}from"./TippyButton-BY_H9Q4Q.js";import"./sweetalert2.esm.all-B0Dix5B2.js";class d{}p(d,"paginate",async t=>{const{result:a}=await i.Fetch("/api/roles/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)});return a}),p(d,"byUser",async t=>{const{result:a}=await i.Fetch(`/api/roles/user/${t}`);return a.data??[]}),p(d,"save",async t=>{try{const{status:a,result:n}=await i.Fetch("/api/roles",{method:"POST",body:JSON.stringify(t)});if(!a)throw new Error((n==null?void 0:n.message)||"Ocurrio un error inesperado");return i.Notify.add({icon:"/assets/img/icon.svg",title:"Correcto",body:n.message,type:"success"}),!0}catch(a){return i.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:a.message,type:"danger"}),!1}}),p(d,"status",async({id:t,status:a})=>{try{const{status:n,result:c}=await i.Fetch("/api/roles/status",{method:"PATCH",body:JSON.stringify({id:t,status:a})});if(!n)throw new Error((c==null?void 0:c.message)??"Ocurrio un error inesperado");return i.Notify.add({icon:"/assets/img/icon.svg",title:"Correcto",body:c.message,type:"success"}),!0}catch(n){return i.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:n.message,type:"danger"}),!1}}),p(d,"delete",async t=>{try{const{status:a,result:n}=await i.Fetch(`/api/roles/${t}`,{method:"DELETE"});if(!a)throw new Error((n==null?void 0:n.message)??"Ocurrio un error inesperado");return i.Notify.add({icon:"/assets/img/icon.svg",title:"Correcto",body:n.message,type:"success"}),!0}catch(a){return i.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:a.message,type:"danger"}),!1}});const j=({id:o,children:t,className:a})=>r.createElement("div",{id:o,className:`accordion custom-accordion ${a}`},t),q=({title:o,id:t,parent:a,children:n,className:c,isOpened:u})=>r.createElement("div",{className:"card mb-1"},r.createElement("div",{className:"card-header p-0",id:`heading-${t}`},r.createElement("h5",{className:"m-0"},r.createElement("a",{className:`d-block text-dark ${!u&&"collapsed"} p-2`,"data-bs-toggle":"collapse",href:`#${t}`,"aria-expanded":"false"},o))),r.createElement("div",{id:t,className:`collapse ${u&&"show"}`,"aria-labelledby":`heading-${t}`,"data-bs-parent":`#${a}`},r.createElement("div",{className:`card-body p-2 ${c}`},n))),J=({permissions:o})=>{o=Object.values(o.map(e=>{const[s]=e.name.split(".");return{...e,origin:s}}).reduce((e,s)=>(e[s.origin]||(e[s.origin]=[]),e[s.origin].push(s),e),{}));const t=l.useRef(),a=l.useRef(),n=l.useRef();l.useRef();const c=l.useRef(),u=l.useRef(),h=l.useRef(),[x,b]=l.useState(!1),[v,T]=l.useState({}),w=e=>{e!=null&&e.id?b(!0):b(!1),c.current.value=(e==null?void 0:e.id)||null,u.current.value=(e==null?void 0:e.name)||null,h.current.value=(e==null?void 0:e.description)||null,$(a.current).modal("show")},F=async e=>{T(e);const s=await N.byRole(e.id);$("#permissions input").prop("checked",!1),s.forEach(({name:m})=>{$(`[name="${m}"]`).prop("checked",!0)}),$(n.current).modal("show")},k=async e=>{e.preventDefault();const s={id:c.current.value||void 0,name:u.current.value,description:h.current.value};await d.save(s)&&($(t.current).dxDataGrid("instance").refresh(),$(a.current).modal("hide"))},C=async e=>{e.preventDefault();const s=[...$("#permissions input:checked")].map(y=>y.value),m={role_id:v.id,permissions:s};await N.massiveByRole(m)&&($(n.current).modal("hide"),$(t.current).dxDataGrid("instance").refresh())},S=async e=>{await d.delete(e)&&$(t.current).dxDataGrid("instance").refresh()};return r.createElement(r.Fragment,null,r.createElement(M,{gridRef:t,title:"Roles",rest:d,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(t.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"Nuevo registro",onClick:()=>w()}})},columns:[{dataField:"id",caption:"ID",dataType:"number",sortOrder:"asc"},{dataField:"name",caption:"Rol"},{dataField:"description",caption:"Descripcion"},{dataField:"created_at",caption:"Fecha creacion",dataType:"date",cellTemplate:(e,{data:s})=>{f(e,r.createElement("span",null,moment(s.created_at).format("LL")))}},{dataField:"updated_at",caption:"Fecha actualizacion",dataType:"date",cellTemplate:(e,{data:s})=>{f(e,r.createElement("span",null,moment(s.updated_at).format("LL")))}},{caption:"Acciones",cellTemplate:(e,{data:s})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),f(e,r.createElement(E,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>w(s)},r.createElement("i",{className:"fa fa-pen"}))),f(e,r.createElement(E,{className:"btn btn-xs btn-soft-dark",title:"Modificar permisos",onClick:()=>F(s),"data-loading-text":'<i class="fa fa-spinner fa-spin"></i>'},r.createElement("i",{className:"fas fa-th-list"}))),f(e,r.createElement(E,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>S(s.id)},r.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}]}),r.createElement(R,{modalRef:a,title:x?"Editar rol":"Agregar rol",onSubmit:k},r.createElement("div",{className:"row"},r.createElement("input",{ref:c,type:"hidden"}),r.createElement(I,{eRef:u,label:"Rol",col:"col-12",required:!0}),r.createElement(B,{eRef:h,label:"Descripcion",col:"col-12"}))),r.createElement(R,{modalRef:n,title:`Permisos para ${v.name}`,btnSubmitText:"Guardar",onSubmit:C,size:"sm"},r.createElement(j,{id:"permissions"},o.map((e,s)=>{const m=e[0].origin;return r.createElement(q,{key:`accordion-${s}`,id:`permission-${m}`,title:m,parent:"permissions",className:"d-flex gap-2 flex-wrap flex-row"},e.map(({id:g,name:y,description:A})=>r.createElement(_,{key:`permission-${g}`,className:"mb-0",id:`permission-ck-${g}`,label:y.replace(`${m}.`,""),name:y,value:g,title:A,style:{width:"max-content"},rounded:!0})))}))))};P((o,t)=>{G(o).render(r.createElement(L,{...t,title:"Roles"},r.createElement(J,{...t})))});

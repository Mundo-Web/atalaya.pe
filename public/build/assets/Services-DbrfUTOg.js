import{j as e}from"./Accordion-B0xeqd_u.js";import{i as g}from"./tippy-react.esm-PO7soYrD.js";import{r}from"./index-B80Lgev0.js";import{c as T}from"./ReactAppend-Da6mr3zD.js";import{m as C}from"./main-DtAlmsP1.js";import{S as D}from"./SurveyStep-C1GxQ1hd.js";import{S as I}from"./ServicesByBusinessesRest-2T5kbbkv.js";import{U as K}from"./UsersByServicesByBusinessesRest-BctE8xLO.js";import{U as Q}from"./UsersRest-Bx3thcWI.js";import{A as V}from"./Adminto-Bd8o-Rrc.js";import{S as X}from"./SelectFormGroup-Cz52Trm3.js";import{M as Z}from"./Modal-DydUDwtE.js";import{C as P}from"./CreateReactScript-RU15QjVK.js";import"./index-STwnHZb6.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./BusinessIWorkCard-B9yG3aQu.js";import"./LoginStep-DIoBarna.js";import"./Logout-C-aUOij0.js";import"./index.esm-B9FXdcpn.js";import"./TippyButton-DN-nzi_f.js";import"./WhatsAppModal-BYoU6ug0.js";const L=(m=[],c)=>{const d=[];return m.forEach((o,h)=>{h==0?d.push(o):d.push(c,o)}),d},ee=new Q,E=new I,j=new K,te=({businesses:m=[],services:c=[],session:d,APP_DOMAIN:o,APP_PROTOCOL:h})=>{var N,S,B;const u=r.useRef(),x=r.useRef(),y=r.useRef(),[b,F]=r.useState(C.GET.business),[z,U]=r.useState({}),[i,f]=r.useState(null),[G,H]=r.useState([]),[J,v]=r.useState(null);r.useEffect(()=>{p()},[b]);const p=async()=>{const t=await E.byBusiness(b),n={};for(const a of t)n[a.service.correlative]=a;return U(n),n},w=({id:t,text:n,element:a})=>{if(!t)return;const s=JSON.parse($(a).attr("data")),l=document.createElement("div");return l.style.display="block",T(l).render(e.jsx(e.Fragment,{children:e.jsx("div",{className:"relative d-flex align-items-center py-2",children:e.jsxs("div",{className:"flex-grow-1 overflow-hidden",children:[e.jsxs("h5",{className:"mt-0 mb-1 text-truncate",children:[e.jsx("i",{className:"fa fa-building me-1"}),n]}),e.jsxs("p",{className:"d-block text-gray mb-0 font-13 text-truncate",children:[s.owner.name," ",s.owner.lastname]})]})})})),l},O=t=>{const n=$(u.current).find("option:selected"),s=JSON.parse(n.attr("data")).person.document_number;history.pushState(null,null,`/services?business=${s}`),F(s)},W=async(t,n)=>{const{isConfirmed:a}=await D.fire({title:"¿Estás seguro?",text:"Habilitar el servicio puede aumentar los costos.",icon:"info",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});if(!a)return;v(n),t.target.disabled=!0;const s=await E.enableService(b,n);t.target.disabled=!1,v(null),s&&p()},M=async t=>{f(t),$(y.current).modal("show")},Y=async()=>{var a,s;const t=[["email","contains",x.current.value],"or",["name","contains",x.current.value],"or",["lastname","contains",x.current.value]];(a=i==null?void 0:i.users)!=null&&a.length&&t.push("and",["!",L((s=i==null?void 0:i.users)==null?void 0:s.map(({email:l})=>["email","=",l]),"or")]);const n=await ee.paginate({filter:t});console.log(n),H((n==null?void 0:n.data)??[])},_=async t=>{const n=i.id;if(!await j.inviteUser(t,n))return;const s=await p();f(s[i.service.correlative])},A=async t=>{if(!await j.delete(t))return;const a=await p();f(a[i.service.correlative])},q=async({correlative:t})=>{const n=$(u.current).find("option:selected"),a=JSON.parse(n.attr("data"));await j.authorize({service:t,business:a.uuid})&&(location.href=`${h}://${t}.${o}/home`)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"calc(100vh - 135px)"},children:e.jsxs("div",{style:{width:"100%",maxWidth:"1200px"},children:[e.jsx("div",{className:"mx-auto",style:{width:"280px",marginBottom:"2rem"},children:e.jsx(X,{eRef:u,templateResult:w,templateSelection:w,onChange:O,className:"shadow-sm",children:m.map((t,n)=>e.jsx("option",{value:t.id,data:JSON.stringify(t),selected:C.GET.business==t.person.document_number,children:t.name},`business-${n}`))})}),e.jsx("div",{className:"d-flex flex-wrap justify-content-center gap-4",children:c.sort((t,n)=>n.status-t.status).map((t,n)=>{const a=z[t.correlative];return e.jsx("div",{className:"card mb-0",style:{width:"100%",maxWidth:"360px",transition:"all 0.3s ease",transform:"translateY(0)",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",cursor:"pointer"},onMouseEnter:s=>{s.currentTarget.style.transform="translateY(-5px)",s.currentTarget.style.boxShadow="0 8px 16px rgba(0,0,0,0.1)"},onMouseLeave:s=>{s.currentTarget.style.transform="translateY(0)",s.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.05)"},children:e.jsxs("div",{className:"card-body",style:{padding:"1.5rem"},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("img",{src:`//${t.correlative}.${o}/assets/img/icon.svg`,alt:t.name,style:{height:"32px",width:"32px",objectFit:"contain",padding:"4px",borderRadius:"8px",backgroundColor:"rgba(0,172,158,0.1)"},onError:s=>s.target.src="/assets/img/icon.svg"}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",style:{fontSize:"1.1rem"},children:e.jsxs("a",{href:"#",className:"text-dark d-flex align-items-center gap-2",onClick:()=>q(t),style:{textDecoration:"none"},children:[t.name,e.jsx("i",{className:"mdi mdi-arrow-top-right text-muted"})]})}),e.jsxs("p",{className:"text-success mb-0 font-13",children:[t.correlative,".",o]})]})]}),e.jsx("div",{className:"badge bg-primary",style:{padding:"0.5rem 1rem",borderRadius:"20px"},children:"Gratis"})]}),e.jsx("p",{className:"text-muted",style:{fontSize:"0.9rem",lineHeight:"1.5",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",height:"42px",marginBottom:"1.5rem"},children:t.description}),e.jsx("div",{className:"d-flex align-items-center justify-content-between",children:a?e.jsxs("div",{className:"w-100",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("h6",{className:"mb-0",children:"Equipo"}),e.jsx(g,{content:"Gestionar usuarios",children:e.jsx("button",{className:"btn btn-soft-primary btn-sm rounded-circle",style:{width:"32px",height:"32px",padding:0},onClick:()=>M(a),children:e.jsx("i",{className:"mdi mdi-account-plus-outline"})})})]}),e.jsx("div",{className:"avatar-group",children:a.users.map((s,l)=>{var R,k;return e.jsx("div",{className:"avatar-group-item mb-0",children:e.jsx(g,{content:`${((R=s==null?void 0:s.person)==null?void 0:R.name)||(s==null?void 0:s.name)} ${((k=s==null?void 0:s.person)==null?void 0:k.lastname)||(s==null?void 0:s.lastname)} ${d.id==s.id&&"(Tú)"}`,children:e.jsx("img",{src:`/api/profile/thumbnail/${s.relative_id}`,className:"rounded-circle",alt:`${s.name} ${s.lastname}`,style:{width:"32px",height:"32px",objectFit:"cover",border:"2px solid white"}})})},`user-${l}`)})})]}):t.status?e.jsx("button",{type:"button",className:"btn btn-primary rounded-pill w-100",style:{background:"linear-gradient(45deg, #00ac9e, #00c9b7)",border:"none",boxShadow:"0 2px 6px rgba(0,172,158,0.2)"},onClick:s=>W(s,t.correlative),children:J?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-spin mdi-loading me-1"})," Habilitando"]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-rocket-launch-outline me-1"})," Habilitar servicio"]})}):e.jsxs("div",{className:"badge bg-warning text-dark",style:{padding:"0.75rem 1.5rem",borderRadius:"20px",fontSize:"0.9rem",width:"100%",textAlign:"center"},children:[e.jsx("i",{className:"mdi mdi-clock-outline me-1"}),"Próximamente"]})})]})},`service-${n}`)})})]})}),e.jsxs(Z,{modalRef:y,onSubmit:t=>t.preventDefault(),title:`Gestionar acceso a ${(N=i==null?void 0:i.service)==null?void 0:N.name}`,size:"md",isStatic:!0,hideFooter:!0,children:[e.jsxs("div",{className:"d-block btn-group mx-auto",style:{width:"max-content"},children:[e.jsxs("button",{type:"button",className:"btn btn-secondary dropdown-toggle","data-bs-toggle":"dropdown","aria-expanded":"false",children:[e.jsx("i",{className:"fa fa-user-plus"})," Agregar usuarios a este servicio"]}),e.jsxs("div",{className:"dropdown-menu dropdown-menu-center p-2",style:{width:"100%"},children:[e.jsx("input",{ref:x,className:"form-control mb-2",type:"text",onChange:Y}),G.map((t,n)=>e.jsx(e.Fragment,{children:e.jsxs("a",{className:"dropdown-item py-1 px-2 border-t",href:"#",onClick:()=>_(t.email),children:[e.jsxs("p",{className:"mb-0 text-bold text-truncate",children:[t==null?void 0:t.name," ",t==null?void 0:t.lastname]}),e.jsx("p",{className:"mb-0 text-muted text-truncate",style:{fontSize:"small"},children:t.email})]},`user-${n}`)}))]})]}),e.jsx("hr",{className:"mx-auto",style:{maxWidth:"240px",width:"100%"}}),e.jsx("div",{children:((S=i==null?void 0:i.users)==null?void 0:S.length)>0?e.jsx("table",{style:{width:"100%"},children:e.jsx("tbody",{children:(B=i==null?void 0:i.users)==null?void 0:B.map((t,n)=>{var a,s;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("img",{src:`/api/profile/thumbnail/${t.relative_id}`,className:"rounded-circle avatar-sm me-1",alt:`${t.name} ${t.lastname}`})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsxs("h5",{className:"mt-1 mb-1 text-truncate",children:[((a=t==null?void 0:t.person)==null?void 0:a.name)||(t==null?void 0:t.name)," ",((s=t==null?void 0:t.person)==null?void 0:s.lastname)||(t==null?void 0:t.lastname)]}),e.jsx("p",{className:"mb-1 text-truncate",style:{fontSize:"small"},children:t==null?void 0:t.email})]})}),e.jsxs("td",{align:"center",children:[t.pivot.invitation_accepted==!1&&e.jsx(g,{content:"El usuario no ha aceptado la invitacion",children:e.jsx("p",{className:"mb-0 text-danger",style:{fontSize:"small"},children:"Pendiente"})}),e.jsx("button",{className:"btn btn-xs btn-white rounded-pill",onClick:()=>A(t.pivot.id),children:e.jsx("i",{className:"fa fa-trash"})})]})]},`user-${n}`)})})}):e.jsx("i",{className:"d-block text-center text-muted",children:"- No hay usuarios vinculados -"})})]})]})};P((m,c)=>{T(m).render(e.jsx(V,{...c,title:"Servicios",children:e.jsx(te,{...c})}))});

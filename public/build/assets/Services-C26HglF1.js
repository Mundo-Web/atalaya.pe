var K=Object.defineProperty;var Q=(l,r,c)=>r in l?K(l,r,{enumerable:!0,configurable:!0,writable:!0,value:c}):l[r]=c;var p=(l,r,c)=>Q(l,typeof r!="symbol"?r+"":r,c);import{m as u,C as V,c as T,j as e,r as x}from"./CreateReactScript-iip1gB5Y.js";import{i as j}from"./tippy-CLq_8JA_.js";import{S as X}from"./sweetalert2.esm.all-B0Dix5B2.js";import{B as O}from"./BasicRest-DFLPWFMv.js";import{U as Z}from"./UsersByServicesByBusinessesRest-C2mn2UrU.js";import{A as P}from"./Adminto-CSif9jKy.js";import{S as L}from"./SelectFormGroup-CYHvIHLV.js";import{M as ee}from"./Modal-BraO4vUP.js";import"./Logout-C5ryHcd-.js";class te extends O{constructor(){super(...arguments);p(this,"path","services-by-business");p(this,"byBusiness",async c=>{try{const{status:o,result:d}=await u.Fetch(`/api/${this.path}/${c}`);if(!o)throw new Error((d==null?void 0:d.message)||"Ocurrio un error al cargar los servicios vinculados a esta empresa");return d.data}catch(o){return console.error(o),null}});p(this,"enableService",async(c,o)=>{try{const{status:d,result:m}=await u.Fetch(`/api/${this.path}`,{method:"POST",body:JSON.stringify({business:c,service:o})});if(!d)throw new Error((m==null?void 0:m.message)||"Ocurrio un error al habilitar el servicio");return u.Notify.add({icon:"/assets/img/icon.svg",title:"Correcto",body:m.message,type:"success"}),m}catch(d){return u.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:d.message,type:"danger"}),null}})}}class se extends O{constructor(){super(...arguments);p(this,"path","users")}}const ne=(l=[],r)=>{const c=[];return l.forEach((o,d)=>{d==0?c.push(o):c.push(r,o)}),c},ae=new se,F=new te,v=new Z,ie=({businesses:l=[],services:r=[],session:c,APP_DOMAIN:o,APP_PROTOCOL:d})=>{var B,R,k;const m=x.useRef(),b=x.useRef(),w=x.useRef(),[f,z]=x.useState(u.GET.business),[U,G]=x.useState({}),[i,y]=x.useState(null),[J,H]=x.useState([]),[W,N]=x.useState(null);x.useEffect(()=>{g()},[f]);const g=async()=>{const t=await F.byBusiness(f),n={};for(const a of t)n[a.service.correlative]=a;return G(n),n},S=({id:t,text:n,element:a})=>{if(!t)return;const s=JSON.parse($(a).attr("data")),h=document.createElement("div");return h.style.display="block",T(h).render(e.jsx(e.Fragment,{children:e.jsx("div",{className:"relative d-flex align-items-center py-2",children:e.jsxs("div",{className:"flex-grow-1 overflow-hidden",children:[e.jsxs("h5",{className:"mt-0 mb-1 text-truncate",children:[e.jsx("i",{className:"fa fa-building me-1"}),n]}),e.jsxs("p",{className:"d-block text-gray mb-0 font-13 text-truncate",children:[s.owner.name," ",s.owner.lastname]})]})})})),h},M=t=>{const n=$(m.current).find("option:selected"),s=JSON.parse(n.attr("data")).person.document_number;history.pushState(null,null,`/services?business=${s}`),z(s)},Y=async(t,n)=>{const{isConfirmed:a}=await X.fire({title:"¿Estás seguro?",text:"Habilitar el servicio puede aumentar los costos.",icon:"info",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});if(!a)return;N(n),t.target.disabled=!0;const s=await F.enableService(f,n);t.target.disabled=!1,N(null),s&&g()},_=async t=>{y(t),$(w.current).modal("show")},A=async()=>{var a,s;const t=[["email","contains",b.current.value],"or",["name","contains",b.current.value],"or",["lastname","contains",b.current.value]];(a=i==null?void 0:i.users)!=null&&a.length&&t.push("and",["!",ne((s=i==null?void 0:i.users)==null?void 0:s.map(({email:h})=>["email","=",h]),"or")]);const n=await ae.paginate({filter:t});console.log(n),H((n==null?void 0:n.data)??[])},q=async t=>{const n=i.id;if(!await v.inviteUser(t,n))return;const s=await g();y(s[i.service.correlative])},D=async t=>{if(!await v.delete(t))return;const a=await g();y(a[i.service.correlative])},I=async({correlative:t})=>{const n=$(m.current).find("option:selected"),a=JSON.parse(n.attr("data"));await v.authorize({service:t,business:a.uuid})&&(location.href=`${d}://${t}.${o}/home`)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"calc(100vh - 135px)"},children:e.jsxs("div",{style:{width:"100%",maxWidth:"1200px"},children:[e.jsx("div",{className:"mx-auto",style:{width:"280px",marginBottom:"2rem"},children:e.jsx(L,{eRef:m,templateResult:S,templateSelection:S,onChange:M,className:"shadow-sm",children:l.map((t,n)=>e.jsx("option",{value:t.id,data:JSON.stringify(t),selected:u.GET.business==t.person.document_number,children:t.name},`business-${n}`))})}),e.jsx("div",{className:"d-flex flex-wrap justify-content-center gap-4",children:r.sort((t,n)=>n.status-t.status).map((t,n)=>{const a=U[t.correlative];return e.jsx("div",{className:"card mb-0",style:{width:"100%",maxWidth:"360px",transition:"all 0.3s ease",transform:"translateY(0)",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",cursor:"pointer"},onMouseEnter:s=>{s.currentTarget.style.transform="translateY(-5px)",s.currentTarget.style.boxShadow="0 8px 16px rgba(0,0,0,0.1)"},onMouseLeave:s=>{s.currentTarget.style.transform="translateY(0)",s.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.05)"},children:e.jsxs("div",{className:"card-body",style:{padding:"1.5rem"},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("img",{src:`//${t.correlative}.${o}/assets/img/icon.svg`,alt:t.name,style:{height:"32px",width:"32px",objectFit:"contain",padding:"4px",borderRadius:"8px",backgroundColor:"rgba(0,172,158,0.1)"},onError:s=>s.target.src="/assets/img/icon.svg"}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",style:{fontSize:"1.1rem"},children:e.jsxs("a",{href:"#",className:"text-dark d-flex align-items-center gap-2",onClick:()=>I(t),style:{textDecoration:"none"},children:[t.name,e.jsx("i",{className:"mdi mdi-arrow-top-right text-muted"})]})}),e.jsxs("p",{className:"text-success mb-0 font-13",children:[t.correlative,".",o]})]})]}),e.jsx("div",{className:"badge bg-primary",style:{padding:"0.5rem 1rem",borderRadius:"20px"},children:"Gratis"})]}),e.jsx("p",{className:"text-muted",style:{fontSize:"0.9rem",lineHeight:"1.5",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",height:"42px",marginBottom:"1.5rem"},children:t.description}),e.jsx("div",{className:"d-flex align-items-center justify-content-between",children:a?e.jsxs("div",{className:"w-100",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("h6",{className:"mb-0",children:"Equipo"}),e.jsx(j,{content:"Gestionar usuarios",children:e.jsx("button",{className:"btn btn-soft-primary btn-sm rounded-circle",style:{width:"32px",height:"32px",padding:0},onClick:()=>_(a),children:e.jsx("i",{className:"mdi mdi-account-plus-outline"})})})]}),e.jsx("div",{className:"avatar-group",children:a.users.map((s,h)=>{var E,C;return e.jsx("div",{className:"avatar-group-item mb-0",children:e.jsx(j,{content:`${((E=s==null?void 0:s.person)==null?void 0:E.name)||(s==null?void 0:s.name)} ${((C=s==null?void 0:s.person)==null?void 0:C.lastname)||(s==null?void 0:s.lastname)} ${c.id==s.id&&"(Tú)"}`,children:e.jsx("img",{src:`/api/profile/thumbnail/${s.relative_id}`,className:"rounded-circle",alt:`${s.name} ${s.lastname}`,style:{width:"32px",height:"32px",objectFit:"cover",border:"2px solid white"}})})},`user-${h}`)})})]}):t.status?e.jsx("button",{type:"button",className:"btn btn-primary rounded-pill w-100",style:{background:"linear-gradient(45deg, #00ac9e, #00c9b7)",border:"none",boxShadow:"0 2px 6px rgba(0,172,158,0.2)"},onClick:s=>Y(s,t.correlative),children:W?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-spin mdi-loading me-1"})," Habilitando"]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-rocket-launch-outline me-1"})," Habilitar servicio"]})}):e.jsxs("div",{className:"badge bg-warning text-dark",style:{padding:"0.75rem 1.5rem",borderRadius:"20px",fontSize:"0.9rem",width:"100%",textAlign:"center"},children:[e.jsx("i",{className:"mdi mdi-clock-outline me-1"}),"Próximamente"]})})]})},`service-${n}`)})})]})}),e.jsxs(ee,{modalRef:w,onSubmit:t=>t.preventDefault(),title:`Gestionar acceso a ${(B=i==null?void 0:i.service)==null?void 0:B.name}`,size:"md",isStatic:!0,hideFooter:!0,children:[e.jsxs("div",{className:"d-block btn-group mx-auto",style:{width:"max-content"},children:[e.jsxs("button",{type:"button",className:"btn btn-secondary dropdown-toggle","data-bs-toggle":"dropdown","aria-expanded":"false",children:[e.jsx("i",{className:"fa fa-user-plus"})," Agregar usuarios a este servicio"]}),e.jsxs("div",{className:"dropdown-menu dropdown-menu-center p-2",style:{width:"100%"},children:[e.jsx("input",{ref:b,className:"form-control mb-2",type:"text",onChange:A}),J.map((t,n)=>e.jsx(e.Fragment,{children:e.jsxs("a",{className:"dropdown-item py-1 px-2 border-t",href:"#",onClick:()=>q(t.email),children:[e.jsxs("p",{className:"mb-0 text-bold text-truncate",children:[t==null?void 0:t.name," ",t==null?void 0:t.lastname]}),e.jsx("p",{className:"mb-0 text-muted text-truncate",style:{fontSize:"small"},children:t.email})]},`user-${n}`)}))]})]}),e.jsx("hr",{className:"mx-auto",style:{maxWidth:"240px",width:"100%"}}),e.jsx("div",{children:((R=i==null?void 0:i.users)==null?void 0:R.length)>0?e.jsx("table",{style:{width:"100%"},children:e.jsx("tbody",{children:(k=i==null?void 0:i.users)==null?void 0:k.map((t,n)=>{var a,s;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("img",{src:`/api/profile/thumbnail/${t.relative_id}`,className:"rounded-circle avatar-sm me-1",alt:`${t.name} ${t.lastname}`})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsxs("h5",{className:"mt-1 mb-1 text-truncate",children:[((a=t==null?void 0:t.person)==null?void 0:a.name)||(t==null?void 0:t.name)," ",((s=t==null?void 0:t.person)==null?void 0:s.lastname)||(t==null?void 0:t.lastname)]}),e.jsx("p",{className:"mb-1 text-truncate",style:{fontSize:"small"},children:t==null?void 0:t.email})]})}),e.jsxs("td",{align:"center",children:[t.pivot.invitation_accepted==!1&&e.jsx(j,{content:"El usuario no ha aceptado la invitacion",children:e.jsx("p",{className:"mb-0 text-danger",style:{fontSize:"small"},children:"Pendiente"})}),e.jsx("button",{className:"btn btn-xs btn-white rounded-pill",onClick:()=>D(t.pivot.id),children:e.jsx("i",{className:"fa fa-trash"})})]})]},`user-${n}`)})})}):e.jsx("i",{className:"d-block text-center text-muted",children:"- No hay usuarios vinculados -"})})]})]})};V((l,r)=>{T(l).render(e.jsx(P,{...r,title:"Servicios",children:e.jsx(ie,{...r})}))});

var A=Object.defineProperty;var W=(c,r,s)=>r in c?A(c,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[r]=s;var z=(c,r,s)=>W(c,typeof r!="symbol"?r+"":r,s);import{i as R,A as L}from"./Adminto-CX-uvMqT.js";import{R as e,C as V,c as J,r as a,m as G}from"./CreateReactScript-Bw6dYrhr.js";import{B as K}from"./BasicRest-B6zr4KsD.js";import{M as P}from"./Modal-ByaRxi_R.js";import{I as d}from"./InputFormGroup-bX1v1nVR.js";import{S as N}from"./SelectFormGroup-B8YTp6dE.js";import{C as Q}from"./CheckboxFormGroup-D3ljp11P.js";import{U as X}from"./UsersByServicesByBusinessesRest-LPE-_3D4.js";import{S as Y}from"./sweetalert2.esm.all-B0Dix5B2.js";class Z extends K{constructor(){super(...arguments);z(this,"path","business")}}const O=({id:c,name:r,owner:s,person:o})=>e.createElement("div",{key:`business-${c}`,className:"card mb-0 border",style:{width:"240px",minHeight:"120px"}},e.createElement("div",{className:"card-body"},e.createElement("h5",{className:"mt-0 mb-1 text-truncate"},e.createElement("i",{className:"fa fa-building me-1"}),r),e.createElement("p",{className:"text-muted mb-1 font-13 text-truncate"},`${s==null?void 0:s.name} ${s==null?void 0:s.lastname}`.trim()||"Sin propietario"),e.createElement("a",{href:`/services?business=${o==null?void 0:o.document_number}`,className:"text-small text-blue"},e.createElement("b",null,"Administrar")))),ee=new X,te=({uuid:c,name:r,APP_PROTOCOL:s,owner:o,my_services:i,APP_DOMAIN:f})=>{const v=async({invitation_accepted:l,invitation_token:b,correlative:m})=>{if(!l){location.href=`${s}://${f}/invitation/${b}`;return}await ee.authorize({service:m,business:c})&&(location.href=`${s}://${m}.${f}/home`)};return e.createElement("div",{key:`business-${c}`,className:"card mb-0 border",style:{width:"240px",minHeight:"120px"}},e.createElement("div",{className:"card-body"},e.createElement("h5",{className:"mt-0 mb-1 text-truncate"},e.createElement("i",{className:"fa fa-building me-1"}),r),e.createElement("p",{className:"text-muted mb-1 font-13 text-truncate"},`${o==null?void 0:o.name} ${o==null?void 0:o.lastname}`.trim()||"Sin propietario"),i.length==1?e.createElement(R,{content:`Abrir ${i[0].name}`},e.createElement("button",{className:"btn btn-xs btn-white",onClick:()=>v(i[0])},e.createElement("img",{src:`//${i[0].correlative}.${f}/assets/img/icon.svg`,alt:i[0].name,style:{height:"16px",aspectRatio:1,objectFit:"contain",objectPosition:"center"},onError:l=>l.target.src="/assets/img/icon.svg"}),e.createElement("span",{className:"ms-1"},i[0].name),!i[0].invitation_accepted&&e.createElement("i",{className:"text-muted ms-1",style:{fontSize:"small"}},"Pendiente"))):e.createElement("div",{style:{position:"relative"}},e.createElement("button",{className:"btn btn-xs btn-light dropdown-toggle",type:"button",id:"dropdown-services-button","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},"Ver servicios ",e.createElement("i",{className:"mdi mdi-chevron-down"})),e.createElement("div",{className:"dropdown-menu","aria-labelledby":"dropdown-services-button"},i.map((l,b)=>e.createElement("button",{key:`service-${b}`,className:"dropdown-item d-flex align-items-center gap-1",target:"_blank",onClick:()=>v(l)},e.createElement("img",{src:`//${l.correlative}.${f}/assets/img/icon.svg`,alt:l.name,style:{height:"16px",aspectRatio:1,objectFit:"contain",objectPosition:"center"},onError:m=>m.target.src="/assets/img/icon.svg"}),e.createElement("span",{className:"ms-1"},l.name),!l.invitation_accepted&&e.createElement("i",{className:"text-muted ms-1",style:{fontSize:"small"}},"Pendiente")))))))},ae=new Z,ne=({businesses:c,businessesIWork:r,economic_sectors:s=[],business_activities:o=[],session:i,APP_DOMAIN:f,APP_PROTOCOL:v})=>{a.useRef();const l=a.useRef(),b=a.useRef(),m=a.useRef(),p=a.useRef(),g=a.useRef(),h=a.useRef(),x=a.useRef(),y=a.useRef(),w=a.useRef(),C=a.useRef(),k=a.useRef(),S=a.useRef(),q=a.useRef(),B=a.useRef(),D=a.useRef(),[u,j]=a.useState(!1),[I,T]=a.useState(!1);a.useEffect(()=>{G.GET.message&&Y.fire({icon:"info",title:"Mensaje",text:G.GET.message,showConfirmButton:!1,timer:5e3}),history.pushState(null,null,"/businesses")},[null]);const H=t=>{var n,E,_,F;t!=null&&t.id?j(!0):j(!1),$('[href="#business-data"]').addClass("active"),$('[href="#owner-data"]').removeClass("active"),$("#business-data").addClass("active"),$("#owner-data").removeClass("active"),b.current.value=(t==null?void 0:t.id)||null,$(m.current).val((t==null?void 0:t.economic_sector_id)??null).trigger("change"),$(p.current).val((t==null?void 0:t.business_activity_id)??null).trigger("change"),g.current.value=(t==null?void 0:t.ruc)||null,h.current.value=(t==null?void 0:t.name)||null,x.current.value=(t==null?void 0:t.lastname)||null,$(y.current).val(((n=t==null?void 0:t.owner)==null?void 0:n.document_type)??"DNI").trigger("change"),w.current.value=((E=t==null?void 0:t.owner)==null?void 0:E.document_number)||null,C.current.value=((_=t==null?void 0:t.owner)==null?void 0:_.name)||null,k.current.value=((F=t==null?void 0:t.owner)==null?void 0:F.lastname)||null,$(l.current).modal("show")},M=async t=>{t.preventDefault();const n={id:b.current.value||void 0,economic_sector_id:m.current.value,economic_sector:$(m.current).find("option:selected").text(),business_activity_id:p.current.value,business_activity:$(p.current).find("option:selected").text(),business:{ruc:g.current.value,tradename:h.current.value,businessname:x.current.value},owner:{document_type:y.current.value,document_number:w.current.value,name:C.current.value,lastname:k.current.value}};I?n.contact=n.owner:n.contact={document_type:S.current.value,document_number:q.current.value,name:B.current.value,lastname:D.current.value};const E=await ae.save(n);E&&($(l.current).modal("hide"),location.href=`/services?business=${E.data}`)},U=async t=>{const n=t.target.value.replace(/\D/g,"");g.current.value=n,n.length<11};return e.createElement(e.Fragment,null,e.createElement("div",{className:"row"},e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"card"},e.createElement("h5",{className:"card-header"},"Mis empresas"),e.createElement("div",{className:"card-body d-flex gap-2 justify-content-center flex-wrap"},e.createElement("div",{key:"business-create",className:"card mb-0 border",style:{width:"240px",minHeight:"120px",cursor:"pointer"},onClick:H},e.createElement("div",{className:"card-body d-flex gap-2 align-items-center justify-content-center flex-column"},e.createElement("i",{className:"fa fa-plus"}),e.createElement("div",null," Crear empresa"))),c.map((t,n)=>e.createElement(O,{key:n,...t,session:i}))))),e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"card"},e.createElement("h5",{className:"card-header"},"Empresas en las que trabajo"),e.createElement("div",{className:"card-body d-flex gap-2 justify-content-center flex-wrap"},r.map((t,n)=>e.createElement(te,{key:n,...t,session:i,APP_DOMAIN:f,APP_PROTOCOL:v})))))),e.createElement(P,{modalRef:l,title:u?"Editar empresa":"Agregar empresa",onSubmit:M,size:"md"},e.createElement("input",{ref:b,type:"hidden"}),e.createElement("ul",{className:"nav nav-pills navtab-bg nav-justified"},e.createElement("li",{className:"nav-item"},e.createElement(R,{content:"Datos de la empresa"},e.createElement("a",{href:"#business-data","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active"},"Empresa"))),e.createElement("li",{className:"nav-item"},e.createElement(R,{content:"Datos del propietario"},e.createElement("a",{href:"#owner-data","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link"},"Propietario"))),e.createElement("li",{className:"nav-item"},e.createElement(R,{content:"Datos del contacto"},e.createElement("a",{href:"#contact-data","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link"},"Contacto")))),e.createElement("div",{className:"tab-content",style:{minHeight:"230px"}},e.createElement("div",{className:"tab-pane active",id:"business-data"},e.createElement("div",{className:"row"},e.createElement(d,{eRef:g,label:"RUC",col:"col-4",required:!0,onChange:U}),e.createElement(d,{eRef:h,label:"Nombre comercial",col:"col-8",required:!0}),e.createElement(d,{eRef:x,label:"Razon social",col:"col-12",required:!0}),e.createElement(N,{eRef:m,label:"Sector Economico",col:"col-md-5",dropdownParent:"#business-data",required:!0},s.map((t,n)=>e.createElement("option",{key:n,value:t.id},t.name))),e.createElement(N,{eRef:p,label:"Actividad comercial",col:"col-md-7",dropdownParent:"#business-data",required:!0},o.map((t,n)=>e.createElement("option",{key:n,value:t.id},t.name))))),e.createElement("div",{className:"tab-pane show",id:"owner-data"},e.createElement("div",{className:"row"},e.createElement(N,{eRef:y,label:"Tipo de documento",col:"col-md-6",dropdownParent:"#owner-data",disabled:u,required:!0},e.createElement("option",{value:"DNI"},"DNI - Documento Nacional de Identidad"),e.createElement("option",{value:"CE"},"CE - Carnet de Extranjeria")),e.createElement(d,{eRef:w,label:"Numero de documento",col:"col-md-6",disabled:u,required:!0}),e.createElement(d,{eRef:C,label:"Nombres",col:"col-6",disabled:u,required:!0}),e.createElement(d,{eRef:k,label:"Apellidos",col:"col-6",disabled:u,required:!0}))),e.createElement("div",{className:"tab-pane show",id:"contact-data"},e.createElement("div",{className:"row"},e.createElement("div",{className:"col-12 mb-2"},e.createElement(Q,{className:"mx-auto",label:"El propietario es el contacto",title:"Marcar si el propietario y el contacto son la misma persona",style:{maxWidth:"max-content"},onChange:t=>T(t.target.checked)})),!I&&e.createElement(e.Fragment,null,e.createElement(N,{eRef:S,label:"Tipo de documento",col:"col-md-6",dropdownParent:"#contact-data",disabled:u,required:!0},e.createElement("option",{value:"DNI"},"DNI - Documento Nacional de Identidad"),e.createElement("option",{value:"CE"},"CE - Carnet de Extranjeria")),e.createElement(d,{eRef:q,label:"Numero de documento",col:"col-md-6",disabled:u,required:!0}),e.createElement(d,{eRef:B,label:"Nombres",col:"col-6",disabled:u,required:!0}),e.createElement(d,{eRef:D,label:"Apellidos",col:"col-6",disabled:u,required:!0})))))))};V((c,r)=>{J(c).render(e.createElement(L,{...r,title:"Empresas"},e.createElement(ne,{...r})))});

var x=Object.defineProperty;var f=(r,t,a)=>t in r?x(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a;var d=(r,t,a)=>f(r,typeof t!="symbol"?t+"":t,a);import{j as e}from"./Accordion-B0xeqd_u.js";import{c as h}from"./ReactAppend-Da6mr3zD.js";import{C as j,G as b}from"./CreateReactScript-wxngZ06p.js";import{A as g}from"./Adminto-qSKIGh_4.js";import{T as R,R as p}from"./Table-BKtRPVyk.js";import{r as m}from"./index-B80Lgev0.js";import{D as B}from"./DxButton-CsjWvhyj.js";import{S as w}from"./SurveyStep-C1GxQ1hd.js";import{B as C}from"./BusinessIWorkCard-CmzstVqU.js";import{M as E}from"./Modal-DydUDwtE.js";import{B as F}from"./BusinessesRest-CnXtJ3iL.js";import"./index-STwnHZb6.js";import"./index.esm-X2U-7gJn.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./main-DtAlmsP1.js";import"./Logout-C-aUOij0.js";import"./tippy-react.esm-PO7soYrD.js";import"./TippyButton-DN-nzi_f.js";import"./WhatsAppModal-BYoU6ug0.js";import"./index-BK7CmI7H.js";class N extends C{constructor(){super(...arguments);d(this,"path","root/users")}}const S=new F,y=({data:r,modalRef:t,setBusinesses:a})=>{const[c,l]=m.useState(!1),s=async()=>{l(!0);const n=await S.byUser(r.id);l(!1),n&&(a(n),$(t.current).modal("show"))};return e.jsx("button",{className:"btn btn-xs btn-soft-primary",onClick:s,disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-loading mdi-spin me-1"}),e.jsx("span",{children:"Cargando"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"me-1",children:r.businesses_count}),r.businesses_count>1?"Empresas":"Empresa"]})})},u=new N,D=()=>{const r=m.useRef(),t=m.useRef(),[a,c]=m.useState([]),l=async s=>{(await w.fire({title:"¿Estás seguro?",text:"¡Esta acción no se puede deshacer!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Sí, eliminar!"})).isConfirmed&&(await u.delete(s),$(r.current).dxDataGrid("instance").refresh())};return e.jsxs(e.Fragment,{children:[e.jsx(R,{gridRef:r,title:"Usuarios",toolBar:s=>{s.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(r.current).dxDataGrid("instance").refresh()}})},rest:u,pageSize:25,columns:[{dataField:"person.document_number",caption:"Documento",width:"120px",cellTemplate:(s,{data:n})=>{var i,o;p(s,e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"badge bg-primary me-1",children:((i=n.person)==null?void 0:i.document_type)??"SD"}),((o=n.person)==null?void 0:o.document_number)??"00000000"]}))}},{dataField:"fullname",caption:"Usuario"},{dataField:"email",caption:"Correo electrónico"},{dataField:"businesses_count",caption:"Empresas",allowFiltering:!1,cellTemplate:(s,{data:n})=>{n.businesses_count!=0&&p(s,e.jsx(y,{data:n,modalRef:t,setBusinesses:c}))}},{caption:"Roles",cellTemplate:(s,{data:n})=>{var i;s.text((i=n.roles)==null?void 0:i.map(o=>o.name).sort().join(", "))}},{caption:"Acciones",cellTemplate:(s,{data:n})=>{s.append(B({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash-alt",onClick:()=>l(n.id)}))}}]}),e.jsx(E,{modalRef:t,title:"Empresas",children:e.jsxs("table",{className:"table table-sm mb-0",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Empresa"}),e.jsx("th",{children:"Servicios"}),e.jsx("th",{children:"Usuarios"})]}),e.jsx("tbody",{children:a.map(s=>{var n;return e.jsxs("tr",{children:[e.jsx("td",{children:s.name}),e.jsx("td",{children:e.jsx("div",{className:"d-flex flex-wrap gap-1",children:(n=s.services)==null?void 0:n.map(i=>e.jsx("img",{className:"avatar-xs",src:`//${i.correlative}.${b.APP_DOMAIN}/assets/img/icon.svg`,onError:o=>o.target.src="/assets/img/icon.svg",alt:i.name,style:{objectFit:"contain",objectPosition:"center"}}))})}),e.jsx("td",{children:s.users.length})]},s.id)})})]})})]})};j((r,t)=>{if(!t.can("users","root"))return location.href="/";h(r).render(e.jsx(g,{...t,title:"Usuarios",children:e.jsx(D,{...t})}))});

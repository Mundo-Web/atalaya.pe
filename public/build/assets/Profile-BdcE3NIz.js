var R=Object.defineProperty;var C=(r,t,a)=>t in r?R(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a;var y=(r,t,a)=>C(r,typeof t!="symbol"?t+"":t,a);import{j as e}from"./Accordion-B0xeqd_u.js";import{r as d}from"./index-B80Lgev0.js";import{c as F}from"./ReactAppend-Da6mr3zD.js";import{A as S}from"./Adminto-CM-4Vh3D.js";import{C as E}from"./CreateReactScript-D3qb0hcY.js";import{I as p}from"./InputFormGroup-Bup-dfDc.js";import{i as P}from"./tippy-react.esm-PO7soYrD.js";import"./TippyButton-DN-nzi_f.js";import{m as n}from"./main-DtAlmsP1.js";import"./index-STwnHZb6.js";import"./Logout-C-aUOij0.js";import"./index.esm-X2U-7gJn.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./WhatsAppModal-BYoU6ug0.js";import"./SurveyStep-C1GxQ1hd.js";class v{}y(v,"save",async t=>{try{const{status:a,result:o}=await n.Fetch("/api/profile",{method:"PATCH",body:JSON.stringify(t)});if(!a)throw new Error((o==null?void 0:o.message)||"Ocurrio un error inesperado");return n.Notify.add({icon:"/assets/img/icon.svg",title:"Correcto",body:o.message,type:"success"}),!0}catch(a){return n.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:a.message,type:"danger"}),!1}});const $=r=>{const t=d.useRef(),a=d.useRef(),o=d.useRef(),[s,h]=d.useState(r.session),j=async u=>{u.preventDefault();const i={name:t.current.value,lastname:a.current.value,birthdate:o.current.value};if(!await v.save(i))return;const c=structuredClone(s);c.name=i.name,c.lastname=i.lastname,c.birthdate=i.birthdate,h(c)},N=async u=>{const i=u.target.files[0];if(i)try{const{full:l,thumbnail:c,type:b,ok:w}=await File.compress(i);if(!w)throw new Error("Ocurrio un error al comprimir la imagen. Intenta con otra.");const f=new FormData;f.append("thumbnail",await File.fromURL(`data:${b};base64,${c}`)),f.append("full",await File.fromURL(`data:${b};base64,${l}`));const x=await fetch("/api/profile",{method:"POST",headers:{"X-Xsrf-Token":decodeURIComponent(n.Cookies.get("XSRF-TOKEN"))},body:f}),m=n.JSON.parseable(await x.text());if(!x.ok)throw new Error((m==null?void 0:m.message)??"Ocurrio un error inesperado");const g=structuredClone(s);g.relative_id=m.data.relative_id,h(g),n.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:"La imagen de perfil se actualizo correctamente",type:"success"})}catch(l){n.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:l.message,type:"danger"})}};return e.jsx(S,{...r,title:"Perfil de usuario",session:s,children:e.jsx("div",{className:"row justify-content-center align-items-center",style:{height:"calc(100vh - 135px)"},children:e.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6 col-sm-8 col-xs-12",children:e.jsxs("form",{className:"card",onSubmit:j,children:[e.jsx("div",{className:"card-header",children:e.jsx("h4",{className:"card-title mb-0",children:"Perfil"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(P,{content:"Cambiar foto de perfil",arrow:!0,children:e.jsxs("label",{htmlFor:"avatar",className:"rounded-circle mx-auto d-block",style:{cursor:"pointer",width:"max-content"},children:[e.jsx("input",{className:"d-none",type:"file",name:"avatar",id:"avatar",accept:"image/*",onChange:N}),e.jsx("img",{className:"avatar-xl rounded-circle",src:`api/profile/${s.relative_id}?v=${crypto.randomUUID()}`,alt:`Perfil de ${s.name} ${s.lastname}`,style:{objectFit:"cover",objectPosition:"center"}})]})}),e.jsx("hr",{className:"mt-3 mb-2"}),e.jsx(p,{eRef:t,label:"Nombres",value:s.name,required:!0}),e.jsx(p,{eRef:a,label:"Apellidos",value:s.lastname,required:!0}),e.jsx(p,{eRef:o,label:"Fecha de nacimiento",value:s.birthdate,type:"date",required:!0}),e.jsx("div",{className:"text-center",children:e.jsxs("button",{className:"btn btn-primary btn-block",type:"submit",children:[e.jsx("i",{className:"fa fa-save"})," Actualizar"]})}),e.jsx("hr",{className:"mt-3 mb-2"}),e.jsx("p",{className:"card-text text-center",children:e.jsxs("small",{className:"text-muted",children:["Ultima actualizacion ",moment(s.updated_at).fromNow()]})})]})]})})})})};E((r,t)=>{F(r).render(e.jsx($,{...t}))});

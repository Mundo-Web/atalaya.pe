var w=Object.defineProperty;var N=(i,a,r)=>a in i?w(i,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[a]=r;var u=(i,a,r)=>N(i,typeof a!="symbol"?a+"":a,r);import{C as v,c as S,j as e,r as m}from"./CreateReactScript-CjXADJBG.js";import{A as B,i as A}from"./Adminto-DVlShn4E.js";import{S as g}from"./sweetalert2.esm.all-B0Dix5B2.js";import{B as F}from"./BasicRest-CvPeBcQU.js";class _ extends F{constructor(){super(...arguments);u(this,"path","signs");u(this,"hasFiles",!0)}}const f=new _,C=({businesses:i=[]})=>{const[a,r]=m.useState(!1),[h,p]=m.useState([]),x=h.reduce((t,s)=>(t[s.business_id]||(t[s.business_id]=[]),t[s.business_id].push(s),t),{}),j=async t=>{const s=t.target.files[0];if(!s)return;if(t.target.value=null,!s.type.startsWith("image/")){g.fire({title:"Error",text:"El archivo debe ser una imagen",icon:"error",confirmButtonText:"Aceptar"});return}const n=t.target.getAttribute("data-id"),l=t.target.getAttribute("data-sign"),c=new FormData;l&&c.append("id",l),c.append("sign",s),c.append("business_id",n),r(!0);const o=await f.save(c);r(!1),o&&d()},y=async t=>{const{isConfirmed:s}=await g.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"No, cancelar"});if(!s)return;r(!0);const n=await f.delete(t);r(!1),n&&d()},d=async()=>{const t=await f.paginate({isLoadingAll:!0,sort:[{selector:"created_at",desc:!1}]});t&&p(t.data)};m.useEffect(()=>{d()},[null]);const b=(t,s,n)=>{var c;const l=`file-${t.uuid}-${n}`;return e.jsxs("div",{className:"position-relative",style:{width:"25%",aspectRatio:".5"},children:[s?e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:l,className:"w-100 h-100",children:e.jsx("img",{src:`/repository/signs/${s.sign}`,alt:`${t.name} signature ${n+1}`,className:"w-100 h-100",style:{objectFit:"cover",objectPosition:"center",cursor:a?"not-allowed":"pointer"}})}),e.jsx(A,{content:"Quitar firma",children:e.jsx("i",{className:"mdi mdi-trash-can mdi-24px position-absolute text-danger",style:{top:"0.25rem",right:"0.25rem"},type:"button",onClick:()=>y(s.id)})})]}):e.jsx("label",{htmlFor:l,className:"d-flex align-items-center justify-content-center w-100 h-100",style:{cursor:a?"not-allowed":"pointer"},children:e.jsx("div",{className:"text-center text-muted",children:e.jsx("i",{className:"fa fa-plus fa-lg"})})}),e.jsx("input",{id:l,type:"file",className:"form-control",accept:"image/*",hidden:!0,"data-id":t.uuid,"data-sign":s==null?void 0:s.id,onChange:j,disabled:a||((c=x[t.id])==null?void 0:c.length)>=4&&!s})]})};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"calc(100vh - 135px)"},children:e.jsx("div",{className:"d-flex flex-wrap justify-content-center gap-3",style:{maxWidth:"960px"},children:i.map((t,s)=>{const n=x[t.id]||[],l=new Array(n.length<4?n.length+1:4).fill(null);return e.jsxs("div",{className:"card mb-0",style:{width:"280px"},children:[e.jsx("div",{className:"card-body position-relative p-0",children:e.jsx("div",{className:"d-flex",children:l.map((c,o)=>b(t,n[o],o))})}),e.jsx("div",{className:"card-footer bg-light",children:e.jsxs("h6",{className:"text-center my-0 text-truncate",children:[e.jsx("i",{className:"fa fa-building me-1"}),e.jsx("b",{children:t.name})]})})]},`business-${s}`)})})})})};v((i,a)=>{S(i).render(e.jsx(B,{...a,title:"Firmas digitales",children:e.jsx(C,{...a})}))});

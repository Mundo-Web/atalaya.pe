var A=Object.defineProperty;var W=(i,a,r)=>a in i?A(i,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[a]=r;var z=(i,a,r)=>W(i,typeof a!="symbol"?a+"":a,r);import{j as e,C as L,c as V,r as n,m as G}from"./CreateReactScript-nMznkPmF.js";import{i as g,A as J}from"./Adminto-Bn6MmTFy.js";import{B as K}from"./BasicRest-zQcbY8rE.js";import{M as P}from"./Modal-BK21EWzi.js";import{I as u}from"./InputFormGroup-CQuSc5Wj.js";import{S as v}from"./SelectFormGroup-Dcy3LrAr.js";import{C as Q}from"./CheckboxFormGroup-CKOqwbh8.js";import{U as X}from"./UsersByServicesByBusinessesRest-D1YY9Qa7.js";import{S as Y}from"./sweetalert2.esm.all-B0Dix5B2.js";import"./Logout-B6F4csKf.js";class Z extends K{constructor(){super(...arguments);z(this,"path","business")}}const O=({id:i,name:a,owner:r,person:l})=>e.jsx("div",{className:"card mb-0 border shadow-sm",style:{width:"240px",minHeight:"120px",transition:"all 0.3s ease"},children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h5",{className:"mt-0 mb-2 text-truncate d-flex align-items-center",children:[e.jsx("i",{className:"fa fa-building me-2 text-primary"}),a]}),e.jsxs("p",{className:"text-muted mb-3 font-13 text-truncate d-flex align-items-center",children:[e.jsx("i",{className:"fa fa-user me-1 opacity-50"}),`${r==null?void 0:r.name} ${r==null?void 0:r.lastname}`.trim()||"Sin propietario"]}),e.jsxs("a",{href:`/services?business=${l==null?void 0:l.document_number}`,className:"btn btn-sm btn-primary w-100",children:[e.jsx("i",{className:"fa fa-cog me-1"}),"Administrar"]})]})},`business-${i}`),ee=new X,se=({uuid:i,name:a,APP_PROTOCOL:r,owner:l,my_services:o,APP_DOMAIN:f})=>{const b=async({invitation_accepted:c,invitation_token:x,correlative:d})=>{if(!c){location.href=`${r}://${f}/invitation/${x}`;return}await ee.authorize({service:d,business:i})&&(location.href=`${r}://${d}.${f}/home`)};return e.jsx("div",{className:"card mb-0 border shadow-sm",style:{width:"240px",minHeight:"120px",transition:"all 0.3s ease"},children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h5",{className:"mt-0 mb-2 text-truncate d-flex align-items-center",children:[e.jsx("i",{className:"fa fa-building me-2 text-info"}),a]}),e.jsxs("p",{className:"text-muted mb-3 font-13 text-truncate d-flex align-items-center",children:[e.jsx("i",{className:"fa fa-user me-1 opacity-50"}),`${l==null?void 0:l.name} ${l==null?void 0:l.lastname}`.trim()||"Sin propietario"]}),o.length==1?e.jsx(g,{content:`Abrir ${o[0].name}`,children:e.jsxs("button",{className:"btn btn-sm btn-info w-100 d-flex align-items-center justify-content-center gap-2",onClick:()=>b(o[0]),children:[e.jsx("img",{src:`//${o[0].correlative}.${f}/assets/img/icon.svg`,alt:o[0].name,style:{height:"16px",aspectRatio:1,objectFit:"contain",objectPosition:"center"},onError:c=>c.target.src="/assets/img/icon.svg"}),e.jsx("span",{children:o[0].name}),!o[0].invitation_accepted&&e.jsx("i",{className:"text-warning ms-1",style:{fontSize:"small"},children:"Pendiente"})]})}):e.jsxs("div",{className:"dropdown w-100",children:[e.jsxs("button",{className:"btn btn-sm btn-info w-100 dropdown-toggle d-flex align-items-center justify-content-center gap-2",type:"button",id:"dropdown-services-button","data-bs-toggle":"dropdown","aria-expanded":"false",children:[e.jsx("i",{className:"fa fa-layer-group"}),"Ver servicios"]}),e.jsx("div",{className:"dropdown-menu w-100 shadow-sm py-2","aria-labelledby":"dropdown-services-button",children:o.map((c,x)=>e.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-2 py-2",onClick:()=>b(c),children:[e.jsx("img",{src:`//${c.correlative}.${f}/assets/img/icon.svg`,alt:c.name,style:{height:"16px",aspectRatio:1,objectFit:"contain",objectPosition:"center"},onError:d=>d.target.src="/assets/img/icon.svg"}),e.jsx("span",{children:c.name}),!c.invitation_accepted&&e.jsx("i",{className:"text-warning ms-auto",style:{fontSize:"small"},children:"Pendiente"})]},`service-${x}`))})]})]})},`business-${i}`)},ne=new Z,te=({businesses:i,businessesIWork:a,economic_sectors:r=[],business_activities:l=[],session:o,APP_DOMAIN:f,APP_PROTOCOL:b})=>{n.useRef();const c=n.useRef(),x=n.useRef(),d=n.useRef(),p=n.useRef(),j=n.useRef(),N=n.useRef(),R=n.useRef(),y=n.useRef(),w=n.useRef(),C=n.useRef(),E=n.useRef(),S=n.useRef(),q=n.useRef(),B=n.useRef(),D=n.useRef(),[m,I]=n.useState(!1),[k,T]=n.useState(!1);n.useEffect(()=>{G.GET.message&&Y.fire({icon:"info",title:"Mensaje",text:G.GET.message,showConfirmButton:!1,timer:5e3}),history.pushState(null,null,"/businesses")},[null]);const H=s=>{var t,h,_,F;s!=null&&s.id?I(!0):I(!1),$('[href="#business-data"]').addClass("active"),$('[href="#owner-data"]').removeClass("active"),$("#business-data").addClass("active"),$("#owner-data").removeClass("active"),x.current.value=(s==null?void 0:s.id)||null,$(d.current).val((s==null?void 0:s.economic_sector_id)??null).trigger("change"),$(p.current).val((s==null?void 0:s.business_activity_id)??null).trigger("change"),j.current.value=(s==null?void 0:s.ruc)||null,N.current.value=(s==null?void 0:s.name)||null,R.current.value=(s==null?void 0:s.lastname)||null,$(y.current).val(((t=s==null?void 0:s.owner)==null?void 0:t.document_type)??"DNI").trigger("change"),w.current.value=((h=s==null?void 0:s.owner)==null?void 0:h.document_number)||null,C.current.value=((_=s==null?void 0:s.owner)==null?void 0:_.name)||null,E.current.value=((F=s==null?void 0:s.owner)==null?void 0:F.lastname)||null,$(c.current).modal("show")},M=async s=>{s.preventDefault();const t={id:x.current.value||void 0,economic_sector_id:d.current.value,economic_sector:$(d.current).find("option:selected").text(),business_activity_id:p.current.value,business_activity:$(p.current).find("option:selected").text(),business:{ruc:j.current.value,tradename:N.current.value,businessname:R.current.value},owner:{document_type:y.current.value,document_number:w.current.value,name:C.current.value,lastname:E.current.value}};k?t.contact=t.owner:t.contact={document_type:S.current.value,document_number:q.current.value,name:B.current.value,lastname:D.current.value};const h=await ne.save(t);h&&($(c.current).modal("hide"),location.href=`/services?business=${h}`)},U=async s=>{const t=s.target.value.replace(/\D/g,"");j.current.value=t,t.length<11};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card h-100",children:[e.jsxs("h5",{className:"card-header d-flex align-items-center",children:[e.jsx("i",{className:"fa fa-building me-2 text-primary"}),"Mis empresas"]}),e.jsx("div",{className:"card-body p-3",children:e.jsxs("div",{className:"d-flex gap-3 justify-content-center flex-wrap",children:[e.jsx("div",{className:"card mb-0 border-2 border-primary border-dashed",style:{width:"240px",minHeight:"120px",cursor:"pointer",transition:"all 0.3s ease"},onClick:H,children:e.jsxs("div",{className:"card-body d-flex gap-2 align-items-center justify-content-center flex-column",children:[e.jsx("div",{className:"rounded-circle bg-primary bg-opacity-10 p-3",children:e.jsx("i",{className:"fa fa-plus text-primary"})}),e.jsx("div",{className:"text-primary",children:" Crear empresa"})]})},"business-create"),i.map((s,t)=>e.jsx(O,{...s,session:o},t))]})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card h-100",children:[e.jsxs("h5",{className:"card-header d-flex align-items-center",children:[e.jsx("i",{className:"fa fa-briefcase me-2 text-info"}),"Empresas en las que trabajo"]}),e.jsx("div",{className:"card-body p-3",children:e.jsx("div",{className:"d-flex gap-3 justify-content-center flex-wrap",children:a.map((s,t)=>e.jsx(se,{...s,session:o,APP_DOMAIN:f,APP_PROTOCOL:b},t))})})]})})]}),e.jsxs(P,{modalRef:c,title:m?"Editar empresa":"Agregar empresa",onSubmit:M,size:"md",children:[e.jsx("input",{ref:x,type:"hidden"}),e.jsxs("ul",{className:"nav nav-pills navtab-bg nav-justified",children:[e.jsx("li",{className:"nav-item",children:e.jsx(g,{content:"Datos de la empresa",children:e.jsx("a",{href:"#business-data","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active",children:"Empresa"})})}),e.jsx("li",{className:"nav-item",children:e.jsx(g,{content:"Datos del propietario",children:e.jsx("a",{href:"#owner-data","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Propietario"})})}),e.jsx("li",{className:"nav-item",children:e.jsx(g,{content:"Datos del contacto",children:e.jsx("a",{href:"#contact-data","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Contacto"})})})]}),e.jsxs("div",{className:"tab-content",style:{minHeight:"230px"},children:[e.jsx("div",{className:"tab-pane active",id:"business-data",children:e.jsxs("div",{className:"row",children:[e.jsx(u,{eRef:j,label:"RUC",col:"col-4",required:!0,onChange:U}),e.jsx(u,{eRef:N,label:"Nombre comercial",col:"col-8",required:!0}),e.jsx(u,{eRef:R,label:"Razon social",col:"col-12",required:!0}),e.jsx(v,{eRef:d,label:"Sector Economico",col:"col-md-5",dropdownParent:"#business-data",required:!0,children:r.map((s,t)=>e.jsx("option",{value:s.id,children:s.name},t))}),e.jsx(v,{eRef:p,label:"Actividad comercial",col:"col-md-7",dropdownParent:"#business-data",required:!0,children:l.map((s,t)=>e.jsx("option",{value:s.id,children:s.name},t))})]})}),e.jsx("div",{className:"tab-pane show",id:"owner-data",children:e.jsxs("div",{className:"row",children:[e.jsxs(v,{eRef:y,label:"Tipo de documento",col:"col-md-6",dropdownParent:"#owner-data",disabled:m,required:!0,children:[e.jsx("option",{value:"DNI",children:"DNI - Documento Nacional de Identidad"}),e.jsx("option",{value:"CE",children:"CE - Carnet de Extranjeria"})]}),e.jsx(u,{eRef:w,label:"Numero de documento",col:"col-md-6",disabled:m,required:!0}),e.jsx(u,{eRef:C,label:"Nombres",col:"col-6",disabled:m,required:!0}),e.jsx(u,{eRef:E,label:"Apellidos",col:"col-6",disabled:m,required:!0})]})}),e.jsx("div",{className:"tab-pane show",id:"contact-data",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 mb-2",children:e.jsx(Q,{className:"mx-auto",label:"El propietario es el contacto",title:"Marcar si el propietario y el contacto son la misma persona",style:{maxWidth:"max-content"},onChange:s=>T(s.target.checked)})}),!k&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{eRef:S,label:"Tipo de documento",col:"col-md-6",dropdownParent:"#contact-data",disabled:m,required:!0,children:[e.jsx("option",{value:"DNI",children:"DNI - Documento Nacional de Identidad"}),e.jsx("option",{value:"CE",children:"CE - Carnet de Extranjeria"})]}),e.jsx(u,{eRef:q,label:"Numero de documento",col:"col-md-6",disabled:m,required:!0}),e.jsx(u,{eRef:B,label:"Nombres",col:"col-6",disabled:m,required:!0}),e.jsx(u,{eRef:D,label:"Apellidos",col:"col-6",disabled:m,required:!0})]})]})})]})]})]})};L((i,a)=>{V(i).render(e.jsx(J,{...a,title:"Empresas",children:e.jsx(te,{...a})}))});

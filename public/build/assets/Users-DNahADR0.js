var h=Object.defineProperty;var j=(n,t,a)=>t in n?h(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a;var d=(n,t,a)=>j(n,typeof t!="symbol"?t+"":t,a);import{j as e}from"./Accordion-B0xeqd_u.js";import{c as b}from"./ReactAppend-Da6mr3zD.js";import{C as g,G as R}from"./CreateReactScript-wxngZ06p.js";import{A as B}from"./Adminto-qSKIGh_4.js";import{T as w,R as u}from"./Table-BKtRPVyk.js";import{r as m}from"./index-B80Lgev0.js";import{D as C}from"./DxButton-CsjWvhyj.js";import{S as p}from"./SurveyStep-C1GxQ1hd.js";import{B as E}from"./BusinessIWorkCard-CmzstVqU.js";import{M as F}from"./Modal-DydUDwtE.js";import{B as N}from"./BusinessesRest-CnXtJ3iL.js";import{i as S}from"./tippy-react.esm-PO7soYrD.js";import"./index-STwnHZb6.js";import"./index.esm-X2U-7gJn.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./main-DtAlmsP1.js";import"./Logout-C-aUOij0.js";import"./TippyButton-DN-nzi_f.js";import"./WhatsAppModal-BYoU6ug0.js";import"./index-BK7CmI7H.js";class _ extends E{constructor(){super(...arguments);d(this,"path","root/users")}}const y=new N,A=({data:n,modalRef:t,setBusinesses:a})=>{const[l,c]=m.useState(!1),s=async()=>{c(!0);const r=await y.byUser(n.id);c(!1),r&&(a(r),$(t.current).modal("show"))};return e.jsx("button",{className:"btn btn-xs btn-soft-primary",onClick:s,disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-loading mdi-spin me-1"}),e.jsx("span",{children:"Cargando"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"me-1",children:n.businesses_count}),n.businesses_count>1?"Empresas":"Empresa"]})})},x=new _,T=()=>{const n=m.useRef(),t=m.useRef(),[a,l]=m.useState([]),c=async s=>{!(await p.fire({title:"¿Estás seguro?",text:"¡Esta acción no se puede deshacer!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Sí, eliminar!"})).isConfirmed||s.businesses_count>0&&!(await p.fire({title:"¡Atención!",text:"Este usuario tiene empresas asociadas. Al eliminarlo, también se eliminarán todas sus empresas. ¿Estás realmente seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Sí, eliminar todo!"})).isConfirmed||!await x.delete(s.id)||$(n.current).dxDataGrid("instance").refresh()};return e.jsxs(e.Fragment,{children:[e.jsx(w,{gridRef:n,title:"Usuarios",toolBar:s=>{s.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(n.current).dxDataGrid("instance").refresh()}})},rest:x,pageSize:25,columns:[{dataField:"person.document_number",caption:"Documento",width:"120px",cellTemplate:(s,{data:r})=>{var i,o;u(s,e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"badge bg-primary me-1",children:((i=r.person)==null?void 0:i.document_type)??"SD"}),((o=r.person)==null?void 0:o.document_number)??"00000000"]}))}},{dataField:"fullname",caption:"Usuario"},{dataField:"email",caption:"Correo electrónico"},{dataField:"businesses_count",caption:"Empresas",allowFiltering:!1,cellTemplate:(s,{data:r})=>{r.businesses_count!=0&&u(s,e.jsx(A,{data:r,modalRef:t,setBusinesses:l}))}},{caption:"Roles",cellTemplate:(s,{data:r})=>{var i;s.text((i=r.roles)==null?void 0:i.map(o=>o.name).sort().join(", "))}},{caption:"Acciones",cellTemplate:(s,{data:r})=>{s.append(C({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash-alt",onClick:()=>c(r)}))}}]}),e.jsx(F,{modalRef:t,title:"Empresas",hideFooter:!0,children:e.jsxs("table",{className:"table table-sm mb-0 table-bordered",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Empresa"}),e.jsx("th",{children:"Servicios"}),e.jsx("th",{children:"Usuarios"})]}),e.jsx("tbody",{children:a.map(s=>{var r,i;return e.jsxs("tr",{children:[e.jsxs("td",{children:[s.name,e.jsx("small",{className:"d-block text-muted",children:(r=s.person)==null?void 0:r.document_number})]}),e.jsx("td",{children:e.jsx("div",{className:"d-flex flex-wrap gap-1",children:(i=s.services)==null?void 0:i.map(o=>e.jsx(S,{content:o.name,children:e.jsx("img",{className:"avatar-xs",src:`//${o.correlative}.${R.APP_DOMAIN}/assets/img/icon.svg`,onError:f=>f.target.src="/assets/img/icon.svg",alt:o.name,style:{objectFit:"contain",objectPosition:"center"}})}))})}),e.jsx("td",{children:s.users.length})]},s.id)})})]})})]})};g((n,t)=>{if(!t.can("users","root"))return location.href="/";b(n).render(e.jsx(B,{...t,title:"Usuarios",children:e.jsx(T,{...t})}))});

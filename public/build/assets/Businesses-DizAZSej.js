import{j as e}from"./Accordion-B0xeqd_u.js";import{i as g}from"./tippy-react.esm-PO7soYrD.js";import{r as n}from"./index-B80Lgev0.js";import{c as U}from"./ReactAppend-Da6mr3zD.js";import{C as A}from"./CreateReactScript-wxngZ06p.js";import{B as W}from"./BusinessesRest-Dm1R5PKi.js";import{A as L}from"./Adminto-D364ytFN.js";import{M as V}from"./Modal-DydUDwtE.js";import{I as d}from"./InputFormGroup-Bup-dfDc.js";import{S as v}from"./SelectFormGroup-Cz52Trm3.js";import{C as J}from"./CheckboxFormGroup-B6kqgdBb.js";import"./index.esm-X2U-7gJn.js";import{U as K}from"./UsersByServicesByBusinessesRest-C2BCIvym.js";import{m as z}from"./main-DtAlmsP1.js";import{S as P}from"./SurveyStep-C1GxQ1hd.js";import"./index-STwnHZb6.js";import"./BusinessIWorkCard-CZ9h3uY_.js";import"./Logout-C-aUOij0.js";import"./TippyButton-DN-nzi_f.js";import"./WhatsAppModal-BYoU6ug0.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";const Q=({id:m,name:u,owner:i,person:a})=>e.jsx("div",{className:"card mb-0 border shadow-sm",style:{width:"240px",minHeight:"120px",transition:"all 0.3s ease"},children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h5",{className:"mt-0 mb-2 text-truncate d-flex align-items-center",children:[e.jsx("i",{className:"fa fa-building me-2 text-primary"}),u]}),e.jsxs("p",{className:"text-muted mb-3 font-13 text-truncate d-flex align-items-center",children:[e.jsx("i",{className:"fa fa-user me-1 opacity-50"}),`${i==null?void 0:i.name} ${i==null?void 0:i.lastname}`.trim()||"Sin propietario"]}),e.jsxs("a",{href:`/services?business=${a==null?void 0:a.document_number}`,className:"btn btn-sm btn-primary w-100",children:[e.jsx("i",{className:"fa fa-cog me-1"}),"Administrar"]})]})},`business-${m}`),X=new K,Y=({uuid:m,name:u,APP_PROTOCOL:i,owner:a,my_services:c,APP_DOMAIN:f})=>{const b=async({invitation_accepted:r,invitation_token:x,correlative:l})=>{if(!r){location.href=`${i}://${f}/invitation/${x}`;return}await X.authorize({service:l,business:m})&&(location.href=`${i}://${l}.${f}/home`)};return e.jsx("div",{className:"card mb-0 border shadow-sm",style:{width:"240px",minHeight:"120px",transition:"all 0.3s ease"},children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h5",{className:"mt-0 mb-2 text-truncate d-flex align-items-center",children:[e.jsx("i",{className:"fa fa-building me-2 text-info"}),u]}),e.jsxs("p",{className:"text-muted mb-3 font-13 text-truncate d-flex align-items-center",children:[e.jsx("i",{className:"fa fa-user me-1 opacity-50"}),`${a==null?void 0:a.name} ${a==null?void 0:a.lastname}`.trim()||"Sin propietario"]}),c.length==1?e.jsx(g,{content:`Abrir ${c[0].name}`,children:e.jsxs("button",{className:"btn btn-sm btn-info w-100 d-flex align-items-center justify-content-center gap-2",onClick:()=>b(c[0]),children:[e.jsx("img",{src:`//${c[0].correlative}.${f}/assets/img/icon.svg`,alt:c[0].name,style:{height:"16px",aspectRatio:1,objectFit:"contain",objectPosition:"center"},onError:r=>r.target.src="/assets/img/icon.svg"}),e.jsx("span",{children:c[0].name}),!c[0].invitation_accepted&&e.jsx("i",{className:"text-warning ms-1",style:{fontSize:"small"},children:"Pendiente"})]})}):e.jsxs("div",{className:"dropdown w-100",children:[e.jsxs("button",{className:"btn btn-sm btn-info w-100 dropdown-toggle d-flex align-items-center justify-content-center gap-2",type:"button",id:"dropdown-services-button","data-bs-toggle":"dropdown","aria-expanded":"false",children:[e.jsx("i",{className:"fa fa-layer-group"}),"Ver servicios"]}),e.jsx("div",{className:"dropdown-menu w-100 shadow-sm py-2","aria-labelledby":"dropdown-services-button",children:c.map((r,x)=>e.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-2 py-2",onClick:()=>b(r),children:[e.jsx("img",{src:`//${r.correlative}.${f}/assets/img/icon.svg`,alt:r.name,style:{height:"16px",aspectRatio:1,objectFit:"contain",objectPosition:"center"},onError:l=>l.target.src="/assets/img/icon.svg"}),e.jsx("span",{children:r.name}),!r.invitation_accepted&&e.jsx("i",{className:"text-warning ms-auto",style:{fontSize:"small"},children:"Pendiente"})]},`service-${x}`))})]})]})},`business-${m}`)},Z=new W,O=({businesses:m,businessesIWork:u,economic_sectors:i=[],business_activities:a=[],session:c,APP_DOMAIN:f,APP_PROTOCOL:b})=>{n.useRef();const r=n.useRef(),x=n.useRef(),l=n.useRef(),p=n.useRef(),j=n.useRef(),N=n.useRef(),R=n.useRef(),y=n.useRef(),w=n.useRef(),C=n.useRef(),E=n.useRef(),S=n.useRef(),q=n.useRef(),D=n.useRef(),B=n.useRef(),[o,I]=n.useState(!1),[k,G]=n.useState(!1);n.useEffect(()=>{z.GET.message&&P.fire({icon:"info",title:"Mensaje",text:z.GET.message,showConfirmButton:!1,timer:5e3}),history.pushState(null,null,"/businesses")},[null]);const T=s=>{var t,h,_,F;s!=null&&s.id?I(!0):I(!1),$('[href="#business-data"]').addClass("active"),$('[href="#owner-data"]').removeClass("active"),$("#business-data").addClass("active"),$("#owner-data").removeClass("active"),x.current.value=(s==null?void 0:s.id)||null,$(l.current).val((s==null?void 0:s.economic_sector_id)??null).trigger("change"),$(p.current).val((s==null?void 0:s.business_activity_id)??null).trigger("change"),j.current.value=(s==null?void 0:s.ruc)||null,N.current.value=(s==null?void 0:s.name)||null,R.current.value=(s==null?void 0:s.lastname)||null,$(y.current).val(((t=s==null?void 0:s.owner)==null?void 0:t.document_type)??"DNI").trigger("change"),w.current.value=((h=s==null?void 0:s.owner)==null?void 0:h.document_number)||null,C.current.value=((_=s==null?void 0:s.owner)==null?void 0:_.name)||null,E.current.value=((F=s==null?void 0:s.owner)==null?void 0:F.lastname)||null,$(r.current).modal("show")},H=async s=>{s.preventDefault();const t={id:x.current.value||void 0,economic_sector_id:l.current.value,economic_sector:$(l.current).find("option:selected").text(),business_activity_id:p.current.value,business_activity:$(p.current).find("option:selected").text(),business:{ruc:j.current.value,tradename:N.current.value,businessname:R.current.value},owner:{document_type:y.current.value,document_number:w.current.value,name:C.current.value,lastname:E.current.value}};k?t.contact=t.owner:t.contact={document_type:S.current.value,document_number:q.current.value,name:D.current.value,lastname:B.current.value};const h=await Z.save(t);h&&($(r.current).modal("hide"),location.href=`/services?business=${h}`)},M=async s=>{const t=s.target.value.replace(/\D/g,"");j.current.value=t,t.length<11};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card h-100",children:[e.jsxs("h5",{className:"card-header d-flex align-items-center",children:[e.jsx("i",{className:"fa fa-building me-2 text-primary"}),"Mis empresas"]}),e.jsx("div",{className:"card-body p-3",children:e.jsxs("div",{className:"d-flex gap-3 justify-content-center flex-wrap",children:[e.jsx("div",{className:"card mb-0 border-2 border-primary border-dashed",style:{width:"240px",minHeight:"120px",cursor:"pointer",transition:"all 0.3s ease"},onClick:T,children:e.jsxs("div",{className:"card-body d-flex gap-2 align-items-center justify-content-center flex-column",children:[e.jsx("div",{className:"rounded-circle bg-primary bg-opacity-10 p-3",children:e.jsx("i",{className:"fa fa-plus text-primary"})}),e.jsx("div",{className:"text-primary",children:" Crear empresa"})]})},"business-create"),m.map((s,t)=>e.jsx(Q,{...s,session:c},t))]})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card h-100",children:[e.jsxs("h5",{className:"card-header d-flex align-items-center",children:[e.jsx("i",{className:"fa fa-briefcase me-2 text-info"}),"Empresas en las que trabajo"]}),e.jsx("div",{className:"card-body p-3",children:e.jsx("div",{className:"d-flex gap-3 justify-content-center flex-wrap",children:u.map((s,t)=>e.jsx(Y,{...s,session:c,APP_DOMAIN:f,APP_PROTOCOL:b},t))})})]})})]}),e.jsxs(V,{modalRef:r,title:o?"Editar empresa":"Agregar empresa",onSubmit:H,size:"md",children:[e.jsx("input",{ref:x,type:"hidden"}),e.jsxs("ul",{className:"nav nav-pills navtab-bg nav-justified",children:[e.jsx("li",{className:"nav-item",children:e.jsx(g,{content:"Datos de la empresa",children:e.jsx("a",{href:"#business-data","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active",children:"Empresa"})})}),e.jsx("li",{className:"nav-item",children:e.jsx(g,{content:"Datos del propietario",children:e.jsx("a",{href:"#owner-data","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Propietario"})})}),e.jsx("li",{className:"nav-item",children:e.jsx(g,{content:"Datos del contacto",children:e.jsx("a",{href:"#contact-data","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Contacto"})})})]}),e.jsxs("div",{className:"tab-content",style:{minHeight:"230px"},children:[e.jsx("div",{className:"tab-pane active",id:"business-data",children:e.jsxs("div",{className:"row",children:[e.jsx(d,{eRef:j,label:"RUC",col:"col-4",required:!0,onChange:M}),e.jsx(d,{eRef:N,label:"Nombre comercial",col:"col-8",required:!0}),e.jsx(d,{eRef:R,label:"Razon social",col:"col-12",required:!0}),e.jsx(v,{eRef:l,label:"Sector Economico",col:"col-md-5",dropdownParent:"#business-data",required:!0,children:i.map((s,t)=>e.jsx("option",{value:s.id,children:s.name},t))}),e.jsx(v,{eRef:p,label:"Actividad comercial",col:"col-md-7",dropdownParent:"#business-data",required:!0,children:a.map((s,t)=>e.jsx("option",{value:s.id,children:s.name},t))})]})}),e.jsx("div",{className:"tab-pane show",id:"owner-data",children:e.jsxs("div",{className:"row",children:[e.jsxs(v,{eRef:y,label:"Tipo de documento",col:"col-md-6",dropdownParent:"#owner-data",disabled:o,required:!0,children:[e.jsx("option",{value:"DNI",children:"DNI - Documento Nacional de Identidad"}),e.jsx("option",{value:"CE",children:"CE - Carnet de Extranjeria"})]}),e.jsx(d,{eRef:w,label:"Numero de documento",col:"col-md-6",disabled:o,required:!0}),e.jsx(d,{eRef:C,label:"Nombres",col:"col-6",disabled:o,required:!0}),e.jsx(d,{eRef:E,label:"Apellidos",col:"col-6",disabled:o,required:!0})]})}),e.jsx("div",{className:"tab-pane show",id:"contact-data",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 mb-2",children:e.jsx(J,{className:"mx-auto",label:"El propietario es el contacto",title:"Marcar si el propietario y el contacto son la misma persona",style:{maxWidth:"max-content"},onChange:s=>G(s.target.checked)})}),!k&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{eRef:S,label:"Tipo de documento",col:"col-md-6",dropdownParent:"#contact-data",disabled:o,required:!0,children:[e.jsx("option",{value:"DNI",children:"DNI - Documento Nacional de Identidad"}),e.jsx("option",{value:"CE",children:"CE - Carnet de Extranjeria"})]}),e.jsx(d,{eRef:q,label:"Numero de documento",col:"col-md-6",disabled:o,required:!0}),e.jsx(d,{eRef:D,label:"Nombres",col:"col-6",disabled:o,required:!0}),e.jsx(d,{eRef:B,label:"Apellidos",col:"col-6",disabled:o,required:!0})]})]})})]})]})]})};A((m,u)=>{U(m).render(e.jsx(L,{...u,title:"Empresas",children:e.jsx(O,{...u})}))});

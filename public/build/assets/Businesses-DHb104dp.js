var A=Object.defineProperty;var W=(c,r,a)=>r in c?A(c,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[r]=a;var z=(c,r,a)=>W(c,typeof r!="symbol"?r+"":r,a);import{j as e,C as L,c as V,r as n,m as G}from"./CreateReactScript-BRu_lQJW.js";import{i as g,A as J}from"./Adminto-P-friiKm.js";import{B as K}from"./BasicRest-D1X3jnBu.js";import{M as P}from"./Modal-M7u4bmpP.js";import{I as m}from"./InputFormGroup-DDAWgn3z.js";import{S as v}from"./SelectFormGroup-rLEJAz9B.js";import{C as Q}from"./CheckboxFormGroup-DbL9XKzE.js";import{U as X}from"./UsersByServicesByBusinessesRest-RNIe6muI.js";import{S as Y}from"./sweetalert2.esm.all-B0Dix5B2.js";class Z extends K{constructor(){super(...arguments);z(this,"path","business")}}const O=({id:c,name:r,owner:a,person:l})=>e.jsx("div",{className:"card mb-0 border",style:{width:"240px",minHeight:"120px"},children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h5",{className:"mt-0 mb-1 text-truncate",children:[e.jsx("i",{className:"fa fa-building me-1"}),r]}),e.jsx("p",{className:"text-muted mb-1 font-13 text-truncate",children:`${a==null?void 0:a.name} ${a==null?void 0:a.lastname}`.trim()||"Sin propietario"}),e.jsx("a",{href:`/services?business=${l==null?void 0:l.document_number}`,className:"text-small text-blue",children:e.jsx("b",{children:"Administrar"})})]})},`business-${c}`),ee=new X,se=({uuid:c,name:r,APP_PROTOCOL:a,owner:l,my_services:o,APP_DOMAIN:h})=>{const f=async({invitation_accepted:i,invitation_token:x,correlative:d})=>{if(!i){location.href=`${a}://${h}/invitation/${x}`;return}await ee.authorize({service:d,business:c})&&(location.href=`${a}://${d}.${h}/home`)};return e.jsx("div",{className:"card mb-0 border",style:{width:"240px",minHeight:"120px"},children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h5",{className:"mt-0 mb-1 text-truncate",children:[e.jsx("i",{className:"fa fa-building me-1"}),r]}),e.jsx("p",{className:"text-muted mb-1 font-13 text-truncate",children:`${l==null?void 0:l.name} ${l==null?void 0:l.lastname}`.trim()||"Sin propietario"}),o.length==1?e.jsx(g,{content:`Abrir ${o[0].name}`,children:e.jsxs("button",{className:"btn btn-xs btn-white",onClick:()=>f(o[0]),children:[e.jsx("img",{src:`//${o[0].correlative}.${h}/assets/img/icon.svg`,alt:o[0].name,style:{height:"16px",aspectRatio:1,objectFit:"contain",objectPosition:"center"},onError:i=>i.target.src="/assets/img/icon.svg"}),e.jsx("span",{className:"ms-1",children:o[0].name}),!o[0].invitation_accepted&&e.jsx("i",{className:"text-muted ms-1",style:{fontSize:"small"},children:"Pendiente"})]})}):e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("button",{className:"btn btn-xs btn-light dropdown-toggle",type:"button",id:"dropdown-services-button","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",children:["Ver servicios ",e.jsx("i",{className:"mdi mdi-chevron-down"})]}),e.jsx("div",{className:"dropdown-menu","aria-labelledby":"dropdown-services-button",children:o.map((i,x)=>e.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-1",target:"_blank",onClick:()=>f(i),children:[e.jsx("img",{src:`//${i.correlative}.${h}/assets/img/icon.svg`,alt:i.name,style:{height:"16px",aspectRatio:1,objectFit:"contain",objectPosition:"center"},onError:d=>d.target.src="/assets/img/icon.svg"}),e.jsx("span",{className:"ms-1",children:i.name}),!i.invitation_accepted&&e.jsx("i",{className:"text-muted ms-1",style:{fontSize:"small"},children:"Pendiente"})]},`service-${x}`))})]})]})},`business-${c}`)},ne=new Z,te=({businesses:c,businessesIWork:r,economic_sectors:a=[],business_activities:l=[],session:o,APP_DOMAIN:h,APP_PROTOCOL:f})=>{n.useRef();const i=n.useRef(),x=n.useRef(),d=n.useRef(),b=n.useRef(),j=n.useRef(),N=n.useRef(),R=n.useRef(),y=n.useRef(),w=n.useRef(),C=n.useRef(),E=n.useRef(),S=n.useRef(),q=n.useRef(),B=n.useRef(),D=n.useRef(),[u,k]=n.useState(!1),[I,T]=n.useState(!1);n.useEffect(()=>{G.GET.message&&Y.fire({icon:"info",title:"Mensaje",text:G.GET.message,showConfirmButton:!1,timer:5e3}),history.pushState(null,null,"/businesses")},[null]);const H=s=>{var t,p,_,F;s!=null&&s.id?k(!0):k(!1),$('[href="#business-data"]').addClass("active"),$('[href="#owner-data"]').removeClass("active"),$("#business-data").addClass("active"),$("#owner-data").removeClass("active"),x.current.value=(s==null?void 0:s.id)||null,$(d.current).val((s==null?void 0:s.economic_sector_id)??null).trigger("change"),$(b.current).val((s==null?void 0:s.business_activity_id)??null).trigger("change"),j.current.value=(s==null?void 0:s.ruc)||null,N.current.value=(s==null?void 0:s.name)||null,R.current.value=(s==null?void 0:s.lastname)||null,$(y.current).val(((t=s==null?void 0:s.owner)==null?void 0:t.document_type)??"DNI").trigger("change"),w.current.value=((p=s==null?void 0:s.owner)==null?void 0:p.document_number)||null,C.current.value=((_=s==null?void 0:s.owner)==null?void 0:_.name)||null,E.current.value=((F=s==null?void 0:s.owner)==null?void 0:F.lastname)||null,$(i.current).modal("show")},M=async s=>{s.preventDefault();const t={id:x.current.value||void 0,economic_sector_id:d.current.value,economic_sector:$(d.current).find("option:selected").text(),business_activity_id:b.current.value,business_activity:$(b.current).find("option:selected").text(),business:{ruc:j.current.value,tradename:N.current.value,businessname:R.current.value},owner:{document_type:y.current.value,document_number:w.current.value,name:C.current.value,lastname:E.current.value}};I?t.contact=t.owner:t.contact={document_type:S.current.value,document_number:q.current.value,name:B.current.value,lastname:D.current.value};const p=await ne.save(t);p&&($(i.current).modal("hide"),location.href=`/services?business=${p.data}`)},U=async s=>{const t=s.target.value.replace(/\D/g,"");j.current.value=t,t.length<11};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card",children:[e.jsx("h5",{className:"card-header",children:"Mis empresas"}),e.jsxs("div",{className:"card-body d-flex gap-2 justify-content-center flex-wrap",children:[e.jsx("div",{className:"card mb-0 border",style:{width:"240px",minHeight:"120px",cursor:"pointer"},onClick:H,children:e.jsxs("div",{className:"card-body d-flex gap-2 align-items-center justify-content-center flex-column",children:[e.jsx("i",{className:"fa fa-plus"}),e.jsx("div",{children:" Crear empresa"})]})},"business-create"),c.map((s,t)=>e.jsx(O,{...s,session:o},t))]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card",children:[e.jsx("h5",{className:"card-header",children:"Empresas en las que trabajo"}),e.jsx("div",{className:"card-body d-flex gap-2 justify-content-center flex-wrap",children:r.map((s,t)=>e.jsx(se,{...s,session:o,APP_DOMAIN:h,APP_PROTOCOL:f},t))})]})})]}),e.jsxs(P,{modalRef:i,title:u?"Editar empresa":"Agregar empresa",onSubmit:M,size:"md",children:[e.jsx("input",{ref:x,type:"hidden"}),e.jsxs("ul",{className:"nav nav-pills navtab-bg nav-justified",children:[e.jsx("li",{className:"nav-item",children:e.jsx(g,{content:"Datos de la empresa",children:e.jsx("a",{href:"#business-data","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active",children:"Empresa"})})}),e.jsx("li",{className:"nav-item",children:e.jsx(g,{content:"Datos del propietario",children:e.jsx("a",{href:"#owner-data","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Propietario"})})}),e.jsx("li",{className:"nav-item",children:e.jsx(g,{content:"Datos del contacto",children:e.jsx("a",{href:"#contact-data","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Contacto"})})})]}),e.jsxs("div",{className:"tab-content",style:{minHeight:"230px"},children:[e.jsx("div",{className:"tab-pane active",id:"business-data",children:e.jsxs("div",{className:"row",children:[e.jsx(m,{eRef:j,label:"RUC",col:"col-4",required:!0,onChange:U}),e.jsx(m,{eRef:N,label:"Nombre comercial",col:"col-8",required:!0}),e.jsx(m,{eRef:R,label:"Razon social",col:"col-12",required:!0}),e.jsx(v,{eRef:d,label:"Sector Economico",col:"col-md-5",dropdownParent:"#business-data",required:!0,children:a.map((s,t)=>e.jsx("option",{value:s.id,children:s.name},t))}),e.jsx(v,{eRef:b,label:"Actividad comercial",col:"col-md-7",dropdownParent:"#business-data",required:!0,children:l.map((s,t)=>e.jsx("option",{value:s.id,children:s.name},t))})]})}),e.jsx("div",{className:"tab-pane show",id:"owner-data",children:e.jsxs("div",{className:"row",children:[e.jsxs(v,{eRef:y,label:"Tipo de documento",col:"col-md-6",dropdownParent:"#owner-data",disabled:u,required:!0,children:[e.jsx("option",{value:"DNI",children:"DNI - Documento Nacional de Identidad"}),e.jsx("option",{value:"CE",children:"CE - Carnet de Extranjeria"})]}),e.jsx(m,{eRef:w,label:"Numero de documento",col:"col-md-6",disabled:u,required:!0}),e.jsx(m,{eRef:C,label:"Nombres",col:"col-6",disabled:u,required:!0}),e.jsx(m,{eRef:E,label:"Apellidos",col:"col-6",disabled:u,required:!0})]})}),e.jsx("div",{className:"tab-pane show",id:"contact-data",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 mb-2",children:e.jsx(Q,{className:"mx-auto",label:"El propietario es el contacto",title:"Marcar si el propietario y el contacto son la misma persona",style:{maxWidth:"max-content"},onChange:s=>T(s.target.checked)})}),!I&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{eRef:S,label:"Tipo de documento",col:"col-md-6",dropdownParent:"#contact-data",disabled:u,required:!0,children:[e.jsx("option",{value:"DNI",children:"DNI - Documento Nacional de Identidad"}),e.jsx("option",{value:"CE",children:"CE - Carnet de Extranjeria"})]}),e.jsx(m,{eRef:q,label:"Numero de documento",col:"col-md-6",disabled:u,required:!0}),e.jsx(m,{eRef:B,label:"Nombres",col:"col-6",disabled:u,required:!0}),e.jsx(m,{eRef:D,label:"Apellidos",col:"col-6",disabled:u,required:!0})]})]})})]})]})]})};L((c,r)=>{V(c).render(e.jsx(J,{...r,title:"Empresas",children:e.jsx(te,{...r})}))});

var k=Object.defineProperty;var I=(a,r,l)=>r in a?k(a,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[r]=l;var R=(a,r,l)=>I(a,typeof r!="symbol"?r+"":r,l);import{r as i,j as e,C as _,c as $}from"./CreateReactScript-CjXADJBG.js";import{A as D,i as U}from"./Adminto-DVlShn4E.js";import{S}from"./sweetalert2.esm.all-B0Dix5B2.js";import{B as L}from"./BasicRest-CvPeBcQU.js";import{M}from"./Modal-CoIai94h.js";import{I as T}from"./InputFormGroup-BpQabOfW.js";class q extends L{constructor(){super(...arguments);R(this,"path","signs");R(this,"hasFiles",!0)}}const G=({id:a,col:r,label:l,eRef:u,required:h=!1,onChange:b=()=>{},aspect:x="21/9",fit:m="cover",width:j="100%",height:y,containerStyle:N,onError:E="/api/cover/thumbnail/null"})=>{a||(a=`ck-${crypto.randomUUID()}`),u||(u=i.useRef());const f=i.useRef(),w=async c=>{const v=c.target.files[0],g=await File.toURL(v);f.current.src=g,b(c)};return i.useEffect(()=>{u.image=f.current},[null]),e.jsxs("div",{className:`form-group ${r} mb-1`,style:N,children:[e.jsxs("label",{htmlFor:a,className:"d-block form-label",children:[l," ",h&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("label",{className:"d-block",htmlFor:a,style:{width:"max-content"},children:e.jsx("img",{ref:f,className:"d-block",src:"",alt:"aspect-video",onError:c=>{c.onError=null,c.target.src=E},style:{width:j,height:y,borderRadius:"4px",cursor:"pointer",aspectRatio:x,objectFit:m,objectPosition:"center"}})}),e.jsx("input",{ref:u,id:a,type:"file",src:"",alt:"",hidden:!0,accept:"image/*",onChange:w})]})},F=new q,P=({businesses:a=[]})=>{const r=i.useRef(),l=i.useRef(),u=i.useRef(),h=i.useRef(),b=i.useRef(),[x,m]=i.useState(!1),[j,y]=i.useState([]),[N,E]=i.useState(!1),f=j.reduce((t,s)=>(t[s.business_id]||(t[s.business_id]=[]),t[s.business_id].push(s),t),{}),w=async t=>{t.preventDefault()},c=async t=>{const s=t.target.files[0];if(!s)return;if(t.target.value=null,!s.type.startsWith("image/")){S.fire({title:"Error",text:"El archivo debe ser una imagen",icon:"error",confirmButtonText:"Aceptar"});return}const{value:n}=await S.fire({title:"Nombre de la firma",input:"text",inputLabel:"Ingrese un nombre para identificar esta firma",showCancelButton:!0,inputValidator:C=>{if(!C)return"Debe ingresar un nombre"}});if(!n)return;const d=t.target.getAttribute("data-id"),p=t.target.getAttribute("data-sign"),o=new FormData;p&&o.append("id",p),o.append("sign",s),o.append("business_id",d),o.append("name",n),m(!0);const B=await F.save(o);m(!1),B&&g()},v=async t=>{const{isConfirmed:s}=await S.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"No, cancelar"});if(!s)return;m(!0);const n=await F.delete(t);m(!1),n&&g()},g=async()=>{const t=await F.paginate({isLoadingAll:!0,sort:[{selector:"created_at",desc:!1}]});t&&y(t.data)};i.useEffect(()=>{g()},[null]);const A=(t,s,n)=>{var p;const d=`file-${t.uuid}-${n}`;return e.jsxs("div",{className:"position-relative",style:{width:"25%",aspectRatio:".5"},children:[s?e.jsxs(e.Fragment,{children:[e.jsxs("label",{htmlFor:d,className:"w-100 h-100",children:[e.jsx("img",{src:`/repository/signs/${s.sign}`,alt:`${t.name} signature ${n+1}`,className:"w-100 h-100",style:{objectFit:"cover",objectPosition:"center",cursor:x?"not-allowed":"pointer"}}),e.jsx("div",{className:"position-absolute bottom-0 start-0 end-0 bg-dark bg-opacity-75 text-white p-1",children:e.jsx("small",{className:"d-block text-center text-truncate",children:s.name||"Sin nombre"})})]}),e.jsx(U,{content:"Quitar firma",children:e.jsx("i",{className:"mdi mdi-trash-can mdi-24px position-absolute text-danger",style:{top:"0.25rem",right:"0.25rem"},type:"button",onClick:()=>v(s.id)})})]}):e.jsx("label",{htmlFor:d,className:"d-flex align-items-center justify-content-center w-100 h-100",style:{cursor:x?"not-allowed":"pointer"},children:e.jsx("div",{className:"text-center text-muted",children:e.jsx("i",{className:"fa fa-plus fa-lg"})})}),e.jsx("input",{id:d,type:"file",className:"form-control",accept:"image/*",hidden:!0,"data-id":t.uuid,"data-sign":s==null?void 0:s.id,onChange:c,disabled:x||((p=f[t.id])==null?void 0:p.length)>=4&&!s})]})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"calc(100vh - 135px)"},children:e.jsx("div",{className:"d-flex flex-wrap justify-content-center gap-3",style:{maxWidth:"960px"},children:a.map((t,s)=>{const n=f[t.id]||[],d=new Array(n.length<4?n.length+1:4).fill(null);return e.jsxs("div",{className:"card mb-0",style:{width:"280px"},children:[e.jsx("div",{className:"card-body position-relative p-0",children:e.jsx("div",{className:"d-flex",children:d.map((p,o)=>A(t,n[o],o))})}),e.jsx("div",{className:"card-footer bg-light",children:e.jsxs("h6",{className:"text-center my-0 text-truncate",children:[e.jsx("i",{className:"fa fa-building me-1"}),e.jsx("b",{children:t.name})]})})]},`business-${s}`)})})}),e.jsxs(M,{modalRef:r,title:N?"Editar firma":"Agregar firma",onSubmit:w,size:"md",children:[e.jsx("input",{ref:l,type:"hidden"}),e.jsx("input",{ref:u,type:"hidden"}),e.jsxs("div",{className:"row",id:"signs-crud-container",children:[e.jsx(T,{eRef:h,label:"Alias",col:"col-12",required:!0}),e.jsx(G,{eRef:b,label:"Firma",col:"col-12",required:!0})]})]})]})};_((a,r)=>{$(a).render(e.jsx(D,{...r,title:"Firmas digitales",children:e.jsx(P,{...r})}))});
